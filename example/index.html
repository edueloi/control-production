
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Autenticação e Produção</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }
        
        .auth-container {
            width: 100%;
            max-width: 450px;
            background-color: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }
        
        .dashboard-container {
            width: 100%;
            max-width: 1200px;
            background-color: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }
        
        .form-container {
            padding: 40px 30px;
        }
        
        h1 {
            text-align: center;
            margin-bottom: 10px;
            color: #333;
        }
        
        .subtitle {
            text-align: center;
            margin-bottom: 30px;
            color: #666;
            font-size: 14px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 500;
        }
        
        input[type="text"],
        input[type="email"],
        input[type="password"],
        input[type="number"],
        input[type="tel"],
        input[type="date"],
        select,
        textarea {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        input:focus, select:focus, textarea:focus {
            border-color: #6a11cb;
            outline: none;
            box-shadow: 0 0 0 2px rgba(106, 17, 203, 0.2);
        }
        
        textarea {
            resize: vertical;
            min-height: 100px;
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .checkbox-group input {
            margin-right: 10px;
        }
        
        .radio-group {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .radio-option {
            display: flex;
            align-items: center;
        }
        
        .radio-option input {
            margin-right: 8px;
        }
        
        .btn {
            padding: 12px 20px;
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .btn-secondary {
            background: #6c757d;
        }
        
        .btn-danger {
            background: #e74c3c;
        }
        
        .btn-success {
            background: #2ecc71;
        }
        
        .btn-warning {
            background: #f39c12;
        }
        
        .btn-info {
            background: #17a2b8;
        }
        
        .links {
            text-align: center;
            margin-top: 20px;
        }
        
        .links a {
            color: #6a11cb;
            text-decoration: none;
            font-size: 14px;
            margin: 0 10px;
            transition: color 0.3s;
        }
        
        .links a:hover {
            text-decoration: underline;
        }
        
        .form-toggle {
            text-align: center;
            margin-top: 30px;
            font-size: 14px;
            color: #666;
        }
        
        .form-toggle a {
            color: #6a11cb;
            text-decoration: none;
            font-weight: 600;
        }
        
        .form-toggle a:hover {
            text-decoration: underline;
        }
        
        .hidden {
            display: none;
        }
        
        .message {
            padding: 10px 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
            font-size: 14px;
        }
        
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .password-strength {
            height: 5px;
            margin-top: 5px;
            border-radius: 5px;
            background-color: #eee;
            overflow: hidden;
        }
        
        .strength-bar {
            height: 100%;
            width: 0;
            transition: width 0.3s, background-color 0.3s;
        }
        
        .weak {
            background-color: #e74c3c;
            width: 33%;
        }
        
        .medium {
            background-color: #f39c12;
            width: 66%;
        }
        
        .strong {
            background-color: #2ecc71;
            width: 100%;
        }
        
        /* Dashboard Styles */
        .dashboard {
            display: flex;
            min-height: 600px;
        }
        
        .sidebar {
            width: 250px;
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: white;
            padding: 20px 0;
        }
        
        .sidebar-header {
            padding: 0 20px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            margin-bottom: 20px;
        }
        
        .sidebar-header h2 {
            font-size: 20px;
        }
        
        .sidebar-menu {
            list-style: none;
        }
        
        .sidebar-menu li {
            padding: 12px 20px;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .sidebar-menu li:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .sidebar-menu li.active {
            background: rgba(255, 255, 255, 0.2);
            border-left: 4px solid white;
        }
        
        .main-content {
            flex: 1;
            padding: 30px;
            background: #f8f9fa;
        }
        
        .content-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }
        
        .content-header h2 {
            color: #333;
        }
        
        .user-info {
            display: flex;
            align-items: center;
        }
        
        .user-info span {
            margin-right: 15px;
            color: #666;
        }
        
        .logout-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .card {
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            padding: 25px;
            margin-bottom: 30px;
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .card-header h3 {
            color: #333;
        }
        
        .table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .table th, .table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        
        .table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #555;
        }
        
        .table tr:hover {
            background: #f8f9fa;
        }
        
        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .form-row .form-group {
            flex: 1;
            margin-bottom: 0;
        }
        
        .ingredient-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            align-items: flex-end;
        }
        
        .ingredient-row .form-group {
            flex: 1;
            margin-bottom: 0;
        }
        
        .production-results {
            background: #e8f5e9;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }
        
        .production-results h4 {
            margin-bottom: 15px;
            color: #2e7d32;
        }
        
        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .result-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }
        
        .result-item .label {
            font-size: 14px;
            color: #666;
        }
        
        .result-item .value {
            font-size: 18px;
            font-weight: 600;
            color: #2e7d32;
        }
        
        .product-type-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .finished {
            background-color: #e8f5e9;
            color: #2e7d32;
        }
        
        .intermediate {
            background-color: #e3f2fd;
            color: #1565c0;
        }
        
        .supply {
            background-color: #fff3e0;
            color: #ef6c00;
        }
        
        .customer-type-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .physical {
            background-color: #e8f5e9;
            color: #2e7d32;
        }
        
        .legal {
            background-color: #e3f2fd;
            color: #1565c0;
        }
        
        .stock-low {
            color: #e74c3c;
            font-weight: bold;
        }
        
        .stock-ok {
            color: #2ecc71;
        }
        
        .stock-warning {
            color: #f39c12;
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .history-item {
            padding: 15px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .history-item:last-child {
            border-bottom: none;
        }
        
        .history-info {
            flex: 1;
        }
        
        .history-date {
            font-size: 14px;
            color: #666;
        }
        
        .history-product {
            font-weight: 600;
            margin: 5px 0;
        }
        
        .history-details {
            font-size: 14px;
            color: #666;
        }
        
        .history-quantity {
            font-weight: 600;
        }
        
        .positive {
            color: #2ecc71;
        }
        
        .negative {
            color: #e74c3c;
        }
        
        .conditional-field {
            display: none;
        }
        
        /* PDV Styles */
        .pdv-container {
            display: flex;
            gap: 20px;
        }
        
        .products-section {
            flex: 1;
        }
        
        .cart-section {
            width: 350px;
        }
        
        .search-box {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .search-box input {
            flex: 1;
        }
        
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            max-height: 400px;
            overflow-y: auto;
            padding: 10px;
            border: 1px solid #eee;
            border-radius: 8px;
        }
        
        .product-card {
            background: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .product-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .product-card h4 {
            margin-bottom: 5px;
            color: #333;
        }
        
        .product-card .price {
            font-weight: 600;
            color: #2e7d32;
            margin-bottom: 5px;
        }
        
        .product-card .stock {
            font-size: 12px;
            color: #666;
        }
        
        .cart {
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            padding: 20px;
        }
        
        .cart-items {
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 20px;
        }
        
        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }
        
        .cart-item:last-child {
            border-bottom: none;
        }
        
        .cart-item-info {
            flex: 1;
        }
        
        .cart-item-name {
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .cart-item-details {
            display: flex;
            justify-content: space-between;
            font-size: 14px;
            color: #666;
        }
        
        .cart-item-actions {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .cart-item-quantity {
            width: 50px;
            text-align: center;
        }
        
        .remove-item {
            background: #e74c3c;
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .cart-summary {
            border-top: 1px solid #eee;
            padding-top: 15px;
        }
        
        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        
        .summary-total {
            font-weight: 600;
            font-size: 18px;
            border-top: 1px solid #eee;
            padding-top: 10px;
            margin-top: 10px;
        }
        
        .payment-section {
            margin-top: 20px;
        }
        
        .receipt {
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            padding: 20px;
            margin-top: 20px;
            font-family: 'Courier New', monospace;
        }
        
        .receipt-header {
            text-align: center;
            margin-bottom: 15px;
            border-bottom: 1px dashed #333;
            padding-bottom: 10px;
        }
        
        .receipt-items {
            margin-bottom: 15px;
        }
        
        .receipt-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }
        
        .receipt-total {
            border-top: 1px dashed #333;
            padding-top: 10px;
            margin-top: 10px;
            font-weight: bold;
        }
        
        /* Relatórios Styles */
        .report-filters {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .report-results {
            margin-top: 20px;
        }
        
        .report-summary {
            background: #e8f5e9;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .report-summary h4 {
            margin-bottom: 10px;
            color: #2e7d32;
        }
        
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .summary-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }
        
        .summary-item .label {
            font-size: 14px;
            color: #666;
        }
        
        .summary-item .value {
            font-size: 18px;
            font-weight: 600;
            color: #2e7d32;
        }
        
        /* Novos estilos para imagem e embalagem */
        .image-preview-container {
            margin-top: 10px;
            text-align: center;
        }
        
        .image-preview {
            max-width: 150px;
            max-height: 150px;
            border-radius: 8px;
            border: 1px solid #ddd;
            display: none;
        }
        
        .remove-image {
            margin-top: 5px;
            background: #e74c3c;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            display: none;
        }
        
        .product-image-pdv {
            width: 100%;
            height: 100px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 10px;
        }
        
        .no-image {
            width: 100%;
            height: 100px;
            background-color: #f8f9fa;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #6c757d;
            font-size: 14px;
            margin-bottom: 10px;
        }
        
        /* Estilo para abas de relatórios */
        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
        }
        
        .tab-btn {
            padding: 10px 20px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }
        
        .tab-btn.active {
            border-bottom: 3px solid #6a11cb;
            color: #6a11cb;
            font-weight: 600;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Estilo para tipo de desconto no PDV */
        .discount-type {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .discount-type input {
            width: auto;
            margin-right: 5px;
        }
        
        /* NOVOS ESTILOS PARA CONSULTAS */
        .search-container {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .search-container h4 {
            margin-bottom: 15px;
            color: #333;
        }
        
        .search-options {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .search-option {
            display: flex;
            align-items: center;
        }
        
        .search-option input {
            margin-right: 5px;
        }
        
        .search-input-group {
            display: flex;
            gap: 10px;
        }
        
        .search-input-group input {
            flex: 1;
        }
        
        @media (max-width: 768px) {
            .dashboard {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
            }
            
            .form-row {
                flex-direction: column;
                gap: 0;
            }
            
            .ingredient-row {
                flex-direction: column;
                align-items: stretch;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .pdv-container {
                flex-direction: column;
            }
            
            .cart-section {
                width: 100%;
            }
            
            .search-input-group {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <!-- Tela de Login -->
    <div class="auth-container" id="auth-container">
        <div id="login-form" class="form-container">
            <h1>Login</h1>
            <p class="subtitle">Entre na sua conta para continuar</p>
            
            <div id="login-message" class="message hidden"></div>
            
            <form id="loginForm">
                <div class="form-group">
                    <label for="login-email">E-mail</label>
                    <input type="email" id="login-email" required>
                </div>
                
                <div class="form-group">
                    <label for="login-password">Senha</label>
                    <input type="password" id="login-password" required>
                </div>
                
                <div class="checkbox-group">
                    <input type="checkbox" id="remember-password">
                    <label for="remember-password">Salvar senha</label>
                </div>
                
                <button type="submit" class="btn" style="width: 100%;">Entrar</button>
            </form>
            
            <div class="links">
                <a href="#" id="forgot-password-link">Esqueci minha senha</a>
            </div>
            
            <div class="form-toggle">
                Não tem uma conta? <a href="#" id="show-register">Cadastre-se</a>
            </div>
        </div>
        
        <!-- Tela de Cadastro -->
        <div id="register-form" class="form-container hidden">
            <h1>Cadastro</h1>
            <p class="subtitle">Crie sua conta para começar</p>
            
            <div id="register-message" class="message hidden"></div>
            
            <form id="registerForm">
                <div class="form-group">
                    <label for="register-name">Nome Completo</label>
                    <input type="text" id="register-name" required>
                </div>
                
                <div class="form-group">
                    <label for="register-email">E-mail</label>
                    <input type="email" id="register-email" required>
                </div>
                
                <div class="form-group">
                    <label for="register-password">Senha</label>
                    <input type="password" id="register-password" required>
                    <div class="password-strength">
                        <div id="password-strength-bar" class="strength-bar"></div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="register-confirm-password">Confirmar Senha</label>
                    <input type="password" id="register-confirm-password" required>
                </div>
                
                <button type="submit" class="btn" style="width: 100%;">Cadastrar</button>
            </form>
            
            <div class="form-toggle">
                Já tem uma conta? <a href="#" id="show-login">Faça login</a>
            </div>
        </div>
        
        <!-- Tela de Recuperação de Senha -->
        <div id="recover-form" class="form-container hidden">
            <h1>Recuperar Senha</h1>
            <p class="subtitle">Digite seu e-mail para recuperar a senha</p>
            
            <div id="recover-message" class="message hidden"></div>
            
            <form id="recoverForm">
                <div class="form-group">
                    <label for="recover-email">E-mail</label>
                    <input type="email" id="recover-email" required>
                </div>
                
                <button type="submit" class="btn" style="width: 100%;">Recuperar Senha</button>
            </form>
            
            <div class="form-toggle">
                <a href="#" id="show-login-from-recover">Voltar para o login</a>
            </div>
        </div>
    </div>
    
    <!-- Dashboard após login -->
    <div class="dashboard-container hidden" id="dashboard-container">
        <div class="dashboard">
            <div class="sidebar">
                <div class="sidebar-header">
                    <h2>Sistema de Produção</h2>
                    <p id="user-email-display"></p>
                </div>
                <ul class="sidebar-menu">
                    <li class="active" data-section="products">Cadastro de Produtos</li>
                    <li data-section="production">Controle de Produção</li>
                    <li data-section="stock">Estoque</li>
                    <li data-section="clients">Cadastro de Clientes</li>
                    <li data-section="pdv">PDV</li>
                    <li data-section="reports">Relatórios</li>
                </ul>
            </div>
            <div class="main-content">
                <div class="content-header">
                    <h2 id="section-title">Cadastro de Produtos</h2>
                    <div class="user-info">
                        <span id="user-name-display"></span>
                        <button class="logout-btn" id="logout-btn">Sair</button>
                    </div>
                </div>
                
                <!-- Seção de Cadastro de Produtos -->
                <div id="products-section">
                    <div class="card">
                        <div class="card-header">
                            <h3>Cadastrar Novo Produto</h3>
                        </div>
                        <form id="product-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="product-barcode">Código de Barras</label>
                                    <input type="text" id="product-barcode" required>
                                </div>
                                <div class="form-group">
                                    <label for="product-description">Descrição</label>
                                    <input type="text" id="product-description" required>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="product-cost">Custo (R$)</label>
                                    <input type="number" id="product-cost" step="0.01" min="0" required>
                                </div>
                                <div class="form-group">
                                    <label for="product-price">Preço de Venda (R$)</label>
                                    <input type="number" id="product-price" step="0.01" min="0" required>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="product-stock">Estoque Inicial</label>
                                    <input type="number" id="product-stock" step="0.01" min="0" value="0" required>
                                </div>
                                <div class="form-group">
                                    <label for="product-min-stock">Estoque Mínimo</label>
                                    <input type="number" id="product-min-stock" step="0.01" min="0" value="0" required>
                                </div>
                            </div>
                            <!-- Campo de embalagem do produto -->
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="product-unit">Embalagem do Produto</label>
                                    <select id="product-unit" required>
                                        <option value="un">UN (Unidade)</option>
                                        <option value="kg">KG (Quilograma)</option>
                                        <option value="l">Litro</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <!-- Campo de imagem do produto -->
                                    <label for="product-image">Imagem do Produto (Opcional)</label>
                                    <input type="file" id="product-image" accept="image/*">
                                    <div class="image-preview-container">
                                        <img id="product-image-preview" class="image-preview" src="" alt="Prévia da imagem">
                                        <button type="button" id="remove-image" class="remove-image">Remover Imagem</button>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Tipo de Produto</label>
                                <div class="radio-group">
                                    <div class="radio-option">
                                        <input type="radio" id="product-type-finished" name="product-type" value="finished" checked>
                                        <label for="product-type-finished">Produto Acabado</label>
                                    </div>
                                    <div class="radio-option">
                                        <input type="radio" id="product-type-intermediate" name="product-type" value="intermediate">
                                        <label for="product-type-intermediate">Produto Intermediário</label>
                                    </div>
                                    <div class="radio-option">
                                        <input type="radio" id="product-type-supply" name="product-type" value="supply">
                                        <label for="product-type-supply">Insumo</label>
                                    </div>
                                </div>
                            </div>
                            <button type="submit" class="btn">Salvar Produto</button>
                        </form>
                    </div>
                    
                    <!-- NOVO: Container de busca de produtos -->
                    <div class="search-container">
                        <h4>Consultar Produtos</h4>
                        <div class="search-options">
                            <div class="search-option">
                                <input type="radio" id="search-product-barcode" name="product-search-type" value="barcode" checked>
                                <label for="search-product-barcode">Código de Barras</label>
                            </div>
                            <div class="search-option">
                                <input type="radio" id="search-product-description" name="product-search-type" value="description">
                                <label for="search-product-description">Descrição</label>
                            </div>
                            <div class="search-option">
                                <input type="radio" id="search-product-all" name="product-search-type" value="all">
                                <label for="search-product-all">Todos os Produtos</label>
                            </div>
                        </div>
                        <div class="search-input-group">
                            <input type="text" id="product-search-input" placeholder="Digite para buscar...">
                            <button type="button" class="btn" id="search-product-consulta-btn">Buscar</button>
                            <button type="button" class="btn btn-secondary" id="clear-product-search">Limpar</button>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h3>Produtos Cadastrados</h3>
                        </div>
                        <div class="table-responsive">
                            <table class="table" id="products-table">
                                <thead>
                                    <tr>
                                        <th>Código</th>
                                        <th>Descrição</th>
                                        <th>Tipo</th>
                                        <th>Embalagem</th>
                                        <th>Custo</th>
                                        <th>Preço</th>
                                        <th>Estoque</th>
                                        <th>Ações</th>
                                    </tr>
                                </thead>
                                <tbody id="products-table-body">
                                    <!-- Produtos serão inseridos aqui via JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- Seção de Controle de Produção -->
                <div id="production-section" class="hidden">
                    <div class="card">
                        <div class="card-header">
                            <h3>Nova Receita de Produção</h3>
                        </div>
                        <form id="production-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="finished-product">Produto Acabado</label>
                                    <select id="finished-product" required>
                                        <option value="">Selecione um produto</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="batch-size">Tamanho do Lote (Unidades)</label>
                                    <input type="number" id="batch-size" min="1" value="1" required>
                                </div>
                            </div>
                            
                            <div class="card-header">
                                <h4>Ingredientes da Receita</h4>
                                <button type="button" class="btn" id="add-ingredient">Adicionar Ingrediente</button>
                            </div>
                            
                            <div id="ingredients-container">
                                <!-- Ingredientes serão adicionados aqui -->
                            </div>
                            
                            <div class="action-buttons">
                                <button type="submit" class="btn">Calcular Custo de Produção</button>
                                <button type="button" class="btn btn-success" id="save-production" disabled>Salvar Produção</button>
                            </div>
                        </form>
                        
                        <div id="production-results" class="production-results hidden">
                            <h4>Resultados da Produção</h4>
                            <div class="results-grid">
                                <div class="result-item">
                                    <div class="label">Custo Total</div>
                                    <div class="value" id="total-cost">R$ 0,00</div>
                                </div>
                                <div class="result-item">
                                    <div class="label">Custo por Unidade</div>
                                    <div class="value" id="unit-cost">R$ 0,00</div>
                                </div>
                                <div class="result-item">
                                    <div class="label">Rendimento</div>
                                    <div class="value" id="yield">0 unidades</div>
                                </div>
                                <div class="result-item">
                                    <div class="label">Margem de Lucro</div>
                                    <div class="value" id="profit-margin">0%</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h3>Histórico de Produção</h3>
                        </div>
                        <div id="production-history">
                            <!-- Histórico de produção será inserido aqui -->
                        </div>
                    </div>
                </div>
                
                <!-- Seção de Estoque -->
                <div id="stock-section" class="hidden">
                    <div class="card">
                        <div class="card-header">
                            <h3>Controle de Estoque</h3>
                        </div>
                        <div class="table-responsive">
                            <table class="table" id="stock-table">
                                <thead>
                                    <tr>
                                        <th>Código</th>
                                        <th>Descrição</th>
                                        <th>Tipo</th>
                                        <th>Embalagem</th>
                                        <th>Estoque Atual</th>
                                        <th>Estoque Mínimo</th>
                                        <th>Status</th>
                                        <th>Ações</th>
                                    </tr>
                                </thead>
                                <tbody id="stock-table-body">
                                    <!-- Estoque será inserido aqui via JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h3>Movimentações de Estoque</h3>
                        </div>
                        <div id="stock-movements">
                            <!-- Movimentações de estoque serão inseridas aqui -->
                        </div>
                    </div>
                </div>
                
                <!-- Seção de Cadastro de Clientes -->
                <div id="clients-section" class="hidden">
                    <div class="card">
                        <div class="card-header">
                            <h3>Cadastrar Novo Cliente</h3>
                        </div>
                        <form id="client-form">
                            <div class="form-group">
                                <label>Tipo de Cliente</label>
                                <div class="radio-group">
                                    <div class="radio-option">
                                        <input type="radio" id="client-type-physical" name="client-type" value="physical" checked>
                                        <label for="client-type-physical">Pessoa Física</label>
                                    </div>
                                    <div class="radio-option">
                                        <input type="radio" id="client-type-legal" name="client-type" value="legal">
                                        <label for="client-type-legal">Pessoa Jurídica</label>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="client-name">Nome Completo / Razão Social</label>
                                    <input type="text" id="client-name" required>
                                </div>
                                <div class="form-group" id="cpf-field">
                                    <label for="client-cpf">CPF</label>
                                    <input type="text" id="client-cpf" placeholder="000.000.000-00" required>
                                </div>
                                <div class="form-group conditional-field" id="cnpj-field">
                                    <label for="client-cnpj">CNPJ</label>
                                    <input type="text" id="client-cnpj" placeholder="00.000.000/0000-00">
                                </div>
                            </div>
                            
                            <div class="form-group conditional-field" id="company-name-field">
                                <label for="client-company-name">Nome Fantasia</label>
                                <input type="text" id="client-company-name">
                            </div>
                            
                            <div class="form-group">
                                <label for="client-email">E-mail</label>
                                <input type="email" id="client-email" required>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="client-phone">Telefone</label>
                                    <input type="tel" id="client-phone" placeholder="(00) 0000-0000">
                                </div>
                                <div class="form-group">
                                    <label for="client-whatsapp">WhatsApp</label>
                                    <input type="tel" id="client-whatsapp" placeholder="(00) 00000-0000">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="client-address">Endereço Completo</label>
                                <textarea id="client-address" required></textarea>
                            </div>
                            
                            <button type="submit" class="btn">Salvar Cliente</button>
                        </form>
                    </div>
                    
                    <!-- Container de busca de clientes -->
                    <div class="search-container">
                        <h4>Consultar Clientes</h4>
                        <div class="search-options">
                            <div class="search-option">
                                <input type="radio" id="search-client-name" name="client-search-type" value="name" checked>
                                <label for="search-client-name">Nome</label>
                            </div>
                            <div class="search-option">
                                <input type="radio" id="search-client-cpf" name="client-search-type" value="cpf">
                                <label for="search-client-cpf">CPF</label>
                            </div>
                            <div class="search-option">
                                <input type="radio" id="search-client-cnpj" name="client-search-type" value="cnpj">
                                <label for="search-client-cnpj">CNPJ</label>
                            </div>
                            <div class="search-option">
                                <input type="radio" id="search-client-all" name="client-search-type" value="all">
                                <label for="search-client-all">Todos os Clientes</label>
                            </div>
                        </div>
                        <div class="search-input-group">
                            <input type="text" id="client-search-input" placeholder="Digite para buscar...">
                            <button type="button" class="btn" id="search-client-btn">Buscar</button>
                            <button type="button" class="btn btn-secondary" id="clear-client-search">Limpar</button>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h3>Clientes Cadastrados</h3>
                        </div>
                        <div class="table-responsive">
                            <table class="table" id="clients-table">
                                <thead>
                                    <tr>
                                        <th>Nome</th>
                                        <th>Tipo</th>
                                        <th>CPF/CNPJ</th>
                                        <th>E-mail</th>
                                        <th>Telefone</th>
                                        <th>WhatsApp</th>
                                        <th>Ações</th>
                                    </tr>
                                </thead>
                                <tbody id="clients-table-body">
                                    <!-- Clientes serão inseridos aqui via JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- Seção de PDV -->
                <div id="pdv-section" class="hidden">
                    <div class="card">
                        <div class="card-header">
                            <h3>Ponto de Venda (PDV)</h3>
                        </div>
                        <div class="pdv-container">
                            <div class="products-section">
                                <div class="search-box">
                                    <input type="text" id="product-search" placeholder="Buscar produto por código ou descrição...">
                                    <button type="button" class="btn" id="search-product-pdv-btn">Buscar</button>
                                </div>
                                <div class="form-group">
                                    <label for="product-type-filter">Filtrar por Tipo:</label>
                                    <select id="product-type-filter">
                                        <option value="all">Todos os Tipos</option>
                                        <option value="finished">Produtos Acabados</option>
                                        <option value="intermediate">Produtos Intermediários</option>
                                        <option value="supply">Insumos</option>
                                    </select>
                                </div>
                                <div class="products-grid" id="products-grid">
                                    <!-- Produtos serão carregados aqui -->
                                </div>
                            </div>
                            <div class="cart-section">
                                <div class="cart">
                                    <h4>Carrinho de Venda</h4>
                                    <div class="cart-items" id="cart-items">
                                        <!-- Itens do carrinho serão inseridos aqui -->
                                    </div>
                                    <div class="cart-summary">
                                        <div class="summary-row">
                                            <span>Subtotal:</span>
                                            <span id="cart-subtotal">R$ 0,00</span>
                                        </div>
                                        <!-- Opção de desconto em % -->
                                        <div class="form-group">
                                            <label>Tipo de Desconto</label>
                                            <div class="discount-type">
                                                <div class="radio-option">
                                                    <input type="radio" id="discount-type-value" name="discount-type" value="value" checked>
                                                    <label for="discount-type-value">Valor (R$)</label>
                                                </div>
                                                <div class="radio-option">
                                                    <input type="radio" id="discount-type-percent" name="discount-type" value="percent">
                                                    <label for="discount-type-percent">Percentual (%)</label>
                                                </div>
                                            </div>
                                            <input type="number" id="discount" step="0.01" min="0" value="0">
                                        </div>
                                        <div class="summary-row">
                                            <span>Desconto:</span>
                                            <span id="cart-discount">R$ 0,00</span>
                                        </div>
                                        <div class="summary-row summary-total">
                                            <span>Total:</span>
                                            <span id="cart-total">R$ 0,00</span>
                                        </div>
                                    </div>
                                    <div class="payment-section">
                                        <div class="form-group">
                                            <label for="payment-method">Forma de Pagamento</label>
                                            <select id="payment-method">
                                                <option value="cash">Dinheiro</option>
                                                <option value="pix">Pix</option>
                                                <option value="debit">Cartão de Débito</option>
                                                <option value="credit">Cartão de Crédito</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label for="sale-client">Cliente (Opcional)</label>
                                            <select id="sale-client">
                                                <option value="">Selecione um cliente</option>
                                            </select>
                                        </div>
                                        <div class="action-buttons">
                                            <button type="button" class="btn btn-success" id="finalize-sale">Finalizar Venda</button>
                                            <button type="button" class="btn btn-secondary" id="clear-cart">Limpar Carrinho</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="receipt hidden" id="receipt">
                        <div class="receipt-header">
                            <h3>CUPOM FISCAL</h3>
                            <p>Loja: Sistema de Produção</p>
                            <p>CNPJ: 00.000.000/0000-00</p>
                            <p id="receipt-date"></p>
                        </div>
                        <div class="receipt-items" id="receipt-items">
                            <!-- Itens do cupom serão inseridos aqui -->
                        </div>
                        <div class="receipt-total">
                            <div class="receipt-item">
                                <span>Total:</span>
                                <span id="receipt-total">R$ 0,00</span>
                            </div>
                            <div class="receipt-item">
                                <span>Forma de Pagamento:</span>
                                <span id="receipt-payment"></span>
                            </div>
                        </div>
                        <div class="action-buttons" style="margin-top: 20px;">
                            <button type="button" class="btn btn-info" id="print-receipt">Imprimir Cupom</button>
                            <button type="button" class="btn btn-warning" id="email-receipt">Enviar por E-mail</button>
                            <button type="button" class="btn btn-secondary" id="new-sale">Nova Venda</button>
                        </div>
                    </div>
                </div>
                
                <!-- Seção de Relatórios -->
                <div id="reports-section" class="hidden">
                    <div class="card">
                        <div class="card-header">
                            <h3>Relatórios</h3>
                        </div>
                        
                        <!-- Abas de Relatórios -->
                        <div class="tabs">
                            <button class="tab-btn active" data-tab="sales-report">Relatório de Vendas</button>
                            <button class="tab-btn" data-tab="production-report">Relatório de Produção</button>
                            <button class="tab-btn" data-tab="client-sales-report">Vendas por Cliente</button>
                        </div>
                        
                        <!-- Relatório de Vendas -->
                        <div id="sales-report" class="tab-content active">
                            <div class="report-filters">
                                <h4>Filtros do Relatório de Vendas</h4>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="sales-start-date">Data Inicial</label>
                                        <input type="date" id="sales-start-date">
                                    </div>
                                    <div class="form-group">
                                        <label for="sales-end-date">Data Final</label>
                                        <input type="date" id="sales-end-date">
                                    </div>
                                    <div class="form-group">
                                        <label for="sales-payment-method">Forma de Pagamento</label>
                                        <select id="sales-payment-method">
                                            <option value="all">Todas</option>
                                            <option value="cash">Dinheiro</option>
                                            <option value="pix">Pix</option>
                                            <option value="debit">Cartão de Débito</option>
                                            <option value="credit">Cartão de Crédito</option>
                                        </select>
                                    </div>
                                </div>
                                <button class="btn" id="generate-sales-report">Gerar Relatório</button>
                                <button class="btn btn-info" id="export-sales-pdf">Exportar PDF</button>
                            </div>
                            
                            <div class="report-results">
                                <div class="report-summary hidden" id="sales-summary">
                                    <h4>Resumo de Vendas</h4>
                                    <div class="summary-grid">
                                        <div class="summary-item">
                                            <div class="label">Total de Vendas</div>
                                            <div class="value" id="total-sales-count">0</div>
                                        </div>
                                        <div class="summary-item">
                                            <div class="label">Valor Total</div>
                                            <div class="value" id="total-sales-amount">R$ 0,00</div>
                                        </div>
                                        <div class="summary-item">
                                            <div class="label">Média por Venda</div>
                                            <div class="value" id="average-sale">R$ 0,00</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="table-responsive">
                                    <table class="table" id="sales-report-table">
                                        <thead>
                                            <tr>
                                                <th>Data</th>
                                                <th>Cliente</th>
                                                <th>Forma de Pagamento</th>
                                                <th>Itens</th>
                                                <th>Subtotal</th>
                                                <th>Desconto</th>
                                                <th>Total</th>
                                            </tr>
                                        </thead>
                                        <tbody id="sales-report-body">
                                            <!-- Dados do relatório serão inseridos aqui -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Relatório de Produção -->
                        <div id="production-report" class="tab-content">
                            <div class="report-filters">
                                <h4>Filtros do Relatório de Produção</h4>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="production-start-date">Data Inicial</label>
                                        <input type="date" id="production-start-date">
                                    </div>
                                    <div class="form-group">
                                        <label for="production-end-date">Data Final</label>
                                        <input type="date" id="production-end-date">
                                    </div>
                                    <div class="form-group">
                                        <label for="production-product">Produto Acabado</label>
                                        <select id="production-product">
                                            <option value="all">Todos</option>
                                        </select>
                                    </div>
                                </div>
                                <button class="btn" id="generate-production-report">Gerar Relatório</button>
                                <button class="btn btn-info" id="export-production-pdf">Exportar PDF</button>
                            </div>
                            
                            <div class="report-results">
                                <div class="report-summary hidden" id="production-summary">
                                    <h4>Resumo de Produção</h4>
                                    <div class="summary-grid">
                                        <div class="summary-item">
                                            <div class="label">Total de Produções</div>
                                            <div class="value" id="total-productions-count">0</div>
                                        </div>
                                        <div class="summary-item">
                                            <div class="label">Custo Total</div>
                                            <div class="value" id="total-production-cost">R$ 0,00</div>
                                        </div>
                                        <div class="summary-item">
                                            <div class="label">Unidades Produzidas</div>
                                            <div class="value" id="total-units-produced">0</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="table-responsive">
                                    <table class="table" id="production-report-table">
                                        <thead>
                                            <tr>
                                                <th>Data</th>
                                                <th>Produto</th>
                                                <th>Quantidade</th>
                                                <th>Custo Total</th>
                                                <th>Custo Unitário</th>
                                                <th>Margem de Lucro</th>
                                            </tr>
                                        </thead>
                                        <tbody id="production-report-body">
                                            <!-- Dados do relatório serão inseridos aqui -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        
                        <!-- NOVA ABA: Relatório de Vendas por Cliente -->
                        <div id="client-sales-report" class="tab-content">
                            <div class="report-filters">
                                <h4>Filtros do Relatório de Vendas por Cliente</h4>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="client-sales-start-date">Data Inicial</label>
                                        <input type="date" id="client-sales-start-date">
                                    </div>
                                    <div class="form-group">
                                        <label for="client-sales-end-date">Data Final</label>
                                        <input type="date" id="client-sales-end-date">
                                    </div>
                                    <div class="form-group">
                                        <label for="client-sales-client">Cliente</label>
                                        <select id="client-sales-client">
                                            <option value="all">Todos os Clientes</option>
                                        </select>
                                    </div>
                                </div>
                                <button class="btn" id="generate-client-sales-report">Gerar Relatório</button>
                                <button class="btn btn-info" id="export-client-sales-pdf">Exportar PDF</button>
                            </div>
                            
                            <div class="report-results">
                                <div class="report-summary hidden" id="client-sales-summary">
                                    <h4>Resumo de Vendas por Cliente</h4>
                                    <div class="summary-grid">
                                        <div class="summary-item">
                                            <div class="label">Total de Vendas</div>
                                            <div class="value" id="client-total-sales-count">0</div>
                                        </div>
                                        <div class="summary-item">
                                            <div class="label">Valor Total</div>
                                            <div class="value" id="client-total-sales-amount">R$ 0,00</div>
                                        </div>
                                        <div class="summary-item">
                                            <div class="label">Média por Venda</div>
                                            <div class="value" id="client-average-sale">R$ 0,00</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="table-responsive">
                                    <table class="table" id="client-sales-report-table">
                                        <thead>
                                            <tr>
                                                <th>Data</th>
                                                <th>Cliente</th>
                                                <th>Forma de Pagamento</th>
                                                <th>Itens</th>
                                                <th>Subtotal</th>
                                                <th>Desconto</th>
                                                <th>Total</th>
                                            </tr>
                                        </thead>
                                        <tbody id="client-sales-report-body">
                                            <!-- Dados do relatório serão inseridos aqui -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Elementos do DOM
        const authContainer = document.getElementById('auth-container');
        const dashboardContainer = document.getElementById('dashboard-container');
        
        const loginFormEl = document.getElementById('login-form');
        const registerFormEl = document.getElementById('register-form');
        const recoverFormEl = document.getElementById('recover-form');
        
        const showRegisterLink = document.getElementById('show-register');
        const showLoginLink = document.getElementById('show-login');
        const forgotPasswordLink = document.getElementById('forgot-password-link');
        const showLoginFromRecoverLink = document.getElementById('show-login-from-recover');
        
        const loginForm = document.getElementById('loginForm');
        const registerForm = document.getElementById('registerForm');
        const recoverForm = document.getElementById('recoverForm');
        
        const passwordInput = document.getElementById('register-password');
        const passwordStrengthBar = document.getElementById('password-strength-bar');
        
        const logoutBtn = document.getElementById('logout-btn');
        const userEmailDisplay = document.getElementById('user-email-display');
        const userNameDisplay = document.getElementById('user-name-display');
        
        const sidebarMenuItems = document.querySelectorAll('.sidebar-menu li');
        const productsSection = document.getElementById('products-section');
        const productionSection = document.getElementById('production-section');
        const stockSection = document.getElementById('stock-section');
        const clientsSection = document.getElementById('clients-section');
        const pdvSection = document.getElementById('pdv-section');
        const reportsSection = document.getElementById('reports-section');
        const sectionTitle = document.getElementById('section-title');
        
        const productForm = document.getElementById('product-form');
        const productsTableBody = document.getElementById('products-table-body');
        const finishedProductSelect = document.getElementById('finished-product');
        
        const productionForm = document.getElementById('production-form');
        const ingredientsContainer = document.getElementById('ingredients-container');
        const addIngredientBtn = document.getElementById('add-ingredient');
        const productionResults = document.getElementById('production-results');
        const saveProductionBtn = document.getElementById('save-production');
        const productionHistory = document.getElementById('production-history');
        
        const stockTableBody = document.getElementById('stock-table-body');
        const stockMovements = document.getElementById('stock-movements');
        
        const clientForm = document.getElementById('client-form');
        const clientsTableBody = document.getElementById('clients-table-body');
        const clientTypeRadios = document.querySelectorAll('input[name="client-type"]');
        const cpfField = document.getElementById('cpf-field');
        const cnpjField = document.getElementById('cnpj-field');
        const companyNameField = document.getElementById('company-name-field');
        
        // Elementos do PDV
        const productSearch = document.getElementById('product-search');
        const searchProductPdvBtn = document.getElementById('search-product-pdv-btn');
        const productTypeFilter = document.getElementById('product-type-filter');
        const productsGrid = document.getElementById('products-grid');
        const cartItems = document.getElementById('cart-items');
        const cartSubtotal = document.getElementById('cart-subtotal');
        const discountInput = document.getElementById('discount');
        const cartDiscount = document.getElementById('cart-discount');
        const cartTotal = document.getElementById('cart-total');
        const paymentMethod = document.getElementById('payment-method');
        const saleClient = document.getElementById('sale-client');
        const finalizeSaleBtn = document.getElementById('finalize-sale');
        const clearCartBtn = document.getElementById('clear-cart');
        const receipt = document.getElementById('receipt');
        const receiptDate = document.getElementById('receipt-date');
        const receiptItems = document.getElementById('receipt-items');
        const receiptTotal = document.getElementById('receipt-total');
        const receiptPayment = document.getElementById('receipt-payment');
        const printReceiptBtn = document.getElementById('print-receipt');
        const emailReceiptBtn = document.getElementById('email-receipt');
        const newSaleBtn = document.getElementById('new-sale');
        
        // Elementos para tipo de desconto no PDV
        const discountTypeRadios = document.querySelectorAll('input[name="discount-type"]');
        
        // Elementos dos Relatórios
        const tabBtns = document.querySelectorAll('.tab-btn');
        const tabContents = document.querySelectorAll('.tab-content');
        
        // Relatório de Vendas
        const salesStartDate = document.getElementById('sales-start-date');
        const salesEndDate = document.getElementById('sales-end-date');
        const salesPaymentMethod = document.getElementById('sales-payment-method');
        const generateSalesReportBtn = document.getElementById('generate-sales-report');
        const exportSalesPdfBtn = document.getElementById('export-sales-pdf');
        const salesSummary = document.getElementById('sales-summary');
        const totalSalesCount = document.getElementById('total-sales-count');
        const totalSalesAmount = document.getElementById('total-sales-amount');
        const averageSale = document.getElementById('average-sale');
        const salesReportBody = document.getElementById('sales-report-body');
        
        // Relatório de Produção
        const productionStartDate = document.getElementById('production-start-date');
        const productionEndDate = document.getElementById('production-end-date');
        const productionProduct = document.getElementById('production-product');
        const generateProductionReportBtn = document.getElementById('generate-production-report');
        const exportProductionPdfBtn = document.getElementById('export-production-pdf');
        const productionSummary = document.getElementById('production-summary');
        const totalProductionsCount = document.getElementById('total-productions-count');
        const totalProductionCost = document.getElementById('total-production-cost');
        const totalUnitsProduced = document.getElementById('total-units-produced');
        const productionReportBody = document.getElementById('production-report-body');
        
        // Elementos para Relatório de Vendas por Cliente
        const clientSalesStartDate = document.getElementById('client-sales-start-date');
        const clientSalesEndDate = document.getElementById('client-sales-end-date');
        const clientSalesClient = document.getElementById('client-sales-client');
        const generateClientSalesReportBtn = document.getElementById('generate-client-sales-report');
        const exportClientSalesPdfBtn = document.getElementById('export-client-sales-pdf');
        const clientSalesSummary = document.getElementById('client-sales-summary');
        const clientTotalSalesCount = document.getElementById('client-total-sales-count');
        const clientTotalSalesAmount = document.getElementById('client-total-sales-amount');
        const clientAverageSale = document.getElementById('client-average-sale');
        const clientSalesReportBody = document.getElementById('client-sales-report-body');
        
        // Elementos para imagem e embalagem
        const productImageInput = document.getElementById('product-image');
        const productImagePreview = document.getElementById('product-image-preview');
        const removeImageBtn = document.getElementById('remove-image');
        const productUnitSelect = document.getElementById('product-unit');
        
        // NOVOS ELEMENTOS: Consulta de produtos e clientes
        // Consulta de produtos
        const searchProductBarcode = document.getElementById('search-product-barcode');
        const searchProductDescription = document.getElementById('search-product-description');
        const searchProductAll = document.getElementById('search-product-all');
        const productSearchInput = document.getElementById('product-search-input');
        const searchProductConsultaBtn = document.getElementById('search-product-consulta-btn');
        const clearProductSearch = document.getElementById('clear-product-search');
        
        // Consulta de clientes
        const searchClientName = document.getElementById('search-client-name');
        const searchClientCpf = document.getElementById('search-client-cpf');
        const searchClientCnpj = document.getElementById('search-client-cnpj');
        const searchClientAll = document.getElementById('search-client-all');
        const clientSearchInput = document.getElementById('client-search-input');
        const searchClientBtn = document.getElementById('search-client-btn');
        const clearClientSearch = document.getElementById('clear-client-search');
        
        // Dados da aplicação
        let products = JSON.parse(localStorage.getItem('products')) || [];
        let productions = JSON.parse(localStorage.getItem('productions')) || [];
        let stockMovementsList = JSON.parse(localStorage.getItem('stockMovements')) || [];
        let clients = JSON.parse(localStorage.getItem('clients')) || [];
        let sales = JSON.parse(localStorage.getItem('sales')) || [];
        let users = JSON.parse(localStorage.getItem('users')) || [];
        let currentUser = null;
        let currentProduction = null;
        let cart = [];
        
        // Alternar entre formulários de autenticação
        showRegisterLink.addEventListener('click', (e) => {
            e.preventDefault();
            loginFormEl.classList.add('hidden');
            registerFormEl.classList.remove('hidden');
            recoverFormEl.classList.add('hidden');
        });
        
        showLoginLink.addEventListener('click', (e) => {
            e.preventDefault();
            registerFormEl.classList.add('hidden');
            loginFormEl.classList.remove('hidden');
            recoverFormEl.classList.add('hidden');
        });
        
        forgotPasswordLink.addEventListener('click', (e) => {
            e.preventDefault();
            loginFormEl.classList.add('hidden');
            registerFormEl.classList.add('hidden');
            recoverFormEl.classList.remove('hidden');
        });
        
        showLoginFromRecoverLink.addEventListener('click', (e) => {
            e.preventDefault();
            recoverFormEl.classList.add('hidden');
            loginFormEl.classList.remove('hidden');
        });
        
        // Validar força da senha
        passwordInput.addEventListener('input', () => {
            const password = passwordInput.value;
            let strength = 0;
            
            if (password.length >= 8) strength++;
            if (/[A-Z]/.test(password)) strength++;
            if (/[0-9]/.test(password)) strength++;
            if (/[^A-Za-z0-9]/.test(password)) strength++;
            
            passwordStrengthBar.className = 'strength-bar';
            
            if (strength <= 1) {
                passwordStrengthBar.classList.add('weak');
            } else if (strength <= 3) {
                passwordStrengthBar.classList.add('medium');
            } else {
                passwordStrengthBar.classList.add('strong');
            }
        });
        
        // Processar formulário de login
        loginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            const rememberPassword = document.getElementById('remember-password').checked;
            
            const messageEl = document.getElementById('login-message');
            
            // Verificar se o usuário existe
            const user = users.find(u => u.email === email && u.password === password);
            
            if (user) {
                currentUser = {
                    name: user.name,
                    email: user.email
                };
                
                // Mostrar dashboard
                authContainer.classList.add('hidden');
                dashboardContainer.classList.remove('hidden');
                
                // Atualizar informações do usuário
                userEmailDisplay.textContent = email;
                userNameDisplay.textContent = currentUser.name;
                
                // Carregar dados
                loadProducts();
                updateFinishedProductSelect();
                loadProductionHistory();
                loadStockMovements();
                loadClients();
                loadSaleClientSelect();
                updateProductionProductSelect();
                updateClientSalesClientSelect();
                
                if (rememberPassword) {
                    localStorage.setItem('savedEmail', email);
                }
                
                // Limpar formulário
                loginForm.reset();
            } else {
                messageEl.textContent = 'E-mail ou senha incorretos.';
                messageEl.className = 'message error';
                messageEl.classList.remove('hidden');
            }
        });
        
        // Processar formulário de cadastro
        registerForm.addEventListener('submit', (e) => {
            e.preventDefault();
            
            const name = document.getElementById('register-name').value;
            const email = document.getElementById('register-email').value;
            const password = document.getElementById('register-password').value;
            const confirmPassword = document.getElementById('register-confirm-password').value;
            
            const messageEl = document.getElementById('register-message');
            
            // Validações básicas
            if (!name || !email || !password || !confirmPassword) {
                messageEl.textContent = 'Por favor, preencha todos os campos.';
                messageEl.className = 'message error';
                messageEl.classList.remove('hidden');
                return;
            }
            
            if (password !== confirmPassword) {
                messageEl.textContent = 'As senhas não coincidem.';
                messageEl.className = 'message error';
                messageEl.classList.remove('hidden');
                return;
            }
            
            if (password.length < 6) {
                messageEl.textContent = 'A senha deve ter pelo menos 6 caracteres.';
                messageEl.className = 'message error';
                messageEl.classList.remove('hidden');
                return;
            }
            
            // Verificar se o email já está cadastrado
            if (users.find(u => u.email === email)) {
                messageEl.textContent = 'Este e-mail já está cadastrado.';
                messageEl.className = 'message error';
                messageEl.classList.remove('hidden');
                return;
            }
            
            // Adicionar novo usuário
            const newUser = {
                name,
                email,
                password
            };
            users.push(newUser);
            localStorage.setItem('users', JSON.stringify(users));
            
            // Simulação de cadastro bem-sucedido
            messageEl.textContent = 'Cadastro realizado com sucesso! Você já pode fazer login.';
            messageEl.className = 'message success';
            messageEl.classList.remove('hidden');
            
            // Limpar formulário
            registerForm.reset();
            passwordStrengthBar.className = 'strength-bar';
            
            // Redirecionar para login após 2 segundos
            setTimeout(() => {
                registerFormEl.classList.add('hidden');
                loginFormEl.classList.remove('hidden');
            }, 2000);
        });
        
        // Processar formulário de recuperação de senha
        recoverForm.addEventListener('submit', (e) => {
            e.preventDefault();
            
            const email = document.getElementById('recover-email').value;
            const messageEl = document.getElementById('recover-message');
            
            if (email) {
                // Verificar se o email existe
                const userExists = users.find(u => u.email === email);
                
                if (userExists) {
                    messageEl.textContent = 'Um e-mail com instruções para recuperar sua senha foi enviado.';
                    messageEl.className = 'message success';
                } else {
                    messageEl.textContent = 'E-mail não encontrado. Verifique se digitou corretamente.';
                    messageEl.className = 'message error';
                }
                
                messageEl.classList.remove('hidden');
                
                // Limpar formulário
                recoverForm.reset();
                
                // Redirecionar para login após 3 segundos
                setTimeout(() => {
                    recoverFormEl.classList.add('hidden');
                    loginFormEl.classList.remove('hidden');
                }, 3000);
            } else {
                messageEl.textContent = 'Por favor, informe seu e-mail.';
                messageEl.className = 'message error';
                messageEl.classList.remove('hidden');
            }
        });
        
        // Logout
        logoutBtn.addEventListener('click', () => {
            currentUser = null;
            dashboardContainer.classList.add('hidden');
            authContainer.classList.remove('hidden');
            loginFormEl.classList.remove('hidden');
            registerFormEl.classList.add('hidden');
            recoverFormEl.classList.add('hidden');
        });
        
        // Navegação do menu lateral
        sidebarMenuItems.forEach(item => {
            item.addEventListener('click', () => {
                // Remover classe active de todos os itens
                sidebarMenuItems.forEach(i => i.classList.remove('active'));
                // Adicionar classe active ao item clicado
                item.classList.add('active');
                
                // Mostrar a seção correspondente
                const section = item.getAttribute('data-section');
                
                if (section === 'products') {
                    productsSection.classList.remove('hidden');
                    productionSection.classList.add('hidden');
                    stockSection.classList.add('hidden');
                    clientsSection.classList.add('hidden');
                    pdvSection.classList.add('hidden');
                    reportsSection.classList.add('hidden');
                    sectionTitle.textContent = 'Cadastro de Produtos';
                } else if (section === 'production') {
                    productsSection.classList.add('hidden');
                    productionSection.classList.remove('hidden');
                    stockSection.classList.add('hidden');
                    clientsSection.classList.add('hidden');
                    pdvSection.classList.add('hidden');
                    reportsSection.classList.add('hidden');
                    sectionTitle.textContent = 'Controle de Produção';
                    updateFinishedProductSelect();
                } else if (section === 'stock') {
                    productsSection.classList.add('hidden');
                    productionSection.classList.add('hidden');
                    stockSection.classList.remove('hidden');
                    clientsSection.classList.add('hidden');
                    pdvSection.classList.add('hidden');
                    reportsSection.classList.add('hidden');
                    sectionTitle.textContent = 'Controle de Estoque';
                    loadStockTable();
                } else if (section === 'clients') {
                    productsSection.classList.add('hidden');
                    productionSection.classList.add('hidden');
                    stockSection.classList.add('hidden');
                    clientsSection.classList.remove('hidden');
                    pdvSection.classList.add('hidden');
                    reportsSection.classList.add('hidden');
                    sectionTitle.textContent = 'Cadastro de Clientes';
                    loadClients();
                } else if (section === 'pdv') {
                    productsSection.classList.add('hidden');
                    productionSection.classList.add('hidden');
                    stockSection.classList.add('hidden');
                    clientsSection.classList.add('hidden');
                    pdvSection.classList.remove('hidden');
                    reportsSection.classList.add('hidden');
                    sectionTitle.textContent = 'Ponto de Venda (PDV)';
                    loadProductsGrid();
                    loadSaleClientSelect();
                } else if (section === 'reports') {
                    productsSection.classList.add('hidden');
                    productionSection.classList.add('hidden');
                    stockSection.classList.add('hidden');
                    clientsSection.classList.add('hidden');
                    pdvSection.classList.add('hidden');
                    reportsSection.classList.remove('hidden');
                    sectionTitle.textContent = 'Relatórios';
                    updateProductionProductSelect();
                    updateClientSalesClientSelect();
                }
            });
        });
        
        // Alternar entre abas nos relatórios
        tabBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                const tabId = btn.getAttribute('data-tab');
                
                // Remover active de todos os botões e conteúdos
                tabBtns.forEach(b => b.classList.remove('active'));
                tabContents.forEach(c => c.classList.remove('active'));
                
                // Adicionar active no botão e conteúdo clicado
                btn.classList.add('active');
                document.getElementById(tabId).classList.add('active');
            });
        });
        
        // Cadastro de produtos
        productForm.addEventListener('submit', (e) => {
            e.preventDefault();
            
            const barcode = document.getElementById('product-barcode').value;
            const description = document.getElementById('product-description').value;
            const cost = parseFloat(document.getElementById('product-cost').value);
            const price = parseFloat(document.getElementById('product-price').value);
            const stock = parseFloat(document.getElementById('product-stock').value);
            const minStock = parseFloat(document.getElementById('product-min-stock').value);
            const type = document.querySelector('input[name="product-type"]:checked').value;
            const unit = productUnitSelect.value;
            
            // Validar se o código de barras já existe
            if (products.find(p => p.barcode === barcode)) {
                alert('Já existe um produto com este código de barras!');
                return;
            }
            
            // Processar imagem (se fornecida)
            let imageData = null;
            if (productImageInput.files && productImageInput.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    imageData = e.target.result;
                    // Continuar com o salvamento do produto após a leitura da imagem
                    saveProductWithImage();
                };
                reader.readAsDataURL(productImageInput.files[0]);
            } else {
                saveProductWithImage();
            }
            
            function saveProductWithImage() {
                // Adicionar produto
                const product = {
                    id: Date.now().toString(),
                    barcode,
                    description,
                    cost,
                    price,
                    stock,
                    minStock,
                    type,
                    unit,
                    image: imageData
                };
                
                products.push(product);
                saveProducts();
                loadProducts();
                updateFinishedProductSelect();
                updateProductionProductSelect();
                
                // Registrar movimentação de estoque inicial
                addStockMovement(product.id, 'ENTRADA', stock, 'Estoque inicial');
                
                // Limpar formulário
                productForm.reset();
                productImagePreview.style.display = 'none';
                removeImageBtn.style.display = 'none';
                
                alert('Produto cadastrado com sucesso!');
            }
        });
        
        // Visualização de imagem antes do upload
        productImageInput.addEventListener('change', function() {
            if (this.files && this.files[0]) {
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    productImagePreview.src = e.target.result;
                    productImagePreview.style.display = 'block';
                    removeImageBtn.style.display = 'inline-block';
                }
                
                reader.readAsDataURL(this.files[0]);
            }
        });
        
        // Remover imagem selecionada
        removeImageBtn.addEventListener('click', function() {
            productImageInput.value = '';
            productImagePreview.style.display = 'none';
            this.style.display = 'none';
        });
        
        // Carregar produtos na tabela
        function loadProducts() {
            productsTableBody.innerHTML = '';
            
            if (products.length === 0) {
                productsTableBody.innerHTML = '<tr><td colspan="8" style="text-align: center;">Nenhum produto cadastrado</td></tr>';
                return;
            }
            
            products.forEach(product => {
                const row = document.createElement('tr');
                const typeBadge = getTypeBadge(product.type);
                const stockClass = getStockClass(product.stock, product.minStock);
                const unitText = getUnitText(product.unit);
                
                row.innerHTML = `
                    <td>${product.barcode}</td>
                    <td>${product.description}</td>
                    <td>${typeBadge}</td>
                    <td>${unitText}</td>
                    <td>R$ ${product.cost.toFixed(2)}</td>
                    <td>R$ ${product.price.toFixed(2)}</td>
                    <td class="${stockClass}">${product.stock}</td>
                    <td>
                        <button class="btn btn-secondary" onclick="editProduct('${product.id}')">Editar</button>
                        <button class="btn btn-danger" onclick="deleteProduct('${product.id}')">Excluir</button>
                    </td>
                `;
                productsTableBody.appendChild(row);
            });
        }
        
        // Obter badge para o tipo de produto
        function getTypeBadge(type) {
            let badgeClass = '';
            let badgeText = '';
            
            switch(type) {
                case 'finished':
                    badgeClass = 'finished';
                    badgeText = 'Acabado';
                    break;
                case 'intermediate':
                    badgeClass = 'intermediate';
                    badgeText = 'Intermediário';
                    break;
                case 'supply':
                    badgeClass = 'supply';
                    badgeText = 'Insumo';
                    break;
            }
            
            return `<span class="product-type-badge ${badgeClass}">${badgeText}</span>`;
        }
        
        // Obter classe CSS para o estoque baseado no nível
        function getStockClass(stock, minStock) {
            if (stock <= 0) return 'stock-low';
            if (stock <= minStock) return 'stock-warning';
            return 'stock-ok';
        }
        
        // Obter texto da embalagem
        function getUnitText(unit) {
            switch(unit) {
                case 'un': return 'UN';
                case 'kg': return 'KG';
                case 'l': return 'Litro';
                default: return unit;
            }
        }
        
        // Atualizar select de produtos acabados
        function updateFinishedProductSelect() {
            finishedProductSelect.innerHTML = '<option value="">Selecione um produto</option>';
            
            // Filtrar apenas produtos acabados
            const finishedProducts = products.filter(product => product.type === 'finished');
            
            finishedProducts.forEach(product => {
                const option = document.createElement('option');
                option.value = product.id;
                option.textContent = `${product.description} (R$ ${product.price.toFixed(2)})`;
                finishedProductSelect.appendChild(option);
            });
        }
        
        // Atualizar select de produtos para relatório de produção
        function updateProductionProductSelect() {
            productionProduct.innerHTML = '<option value="all">Todos</option>';
            
            // Filtrar apenas produtos acabados
            const finishedProducts = products.filter(product => product.type === 'finished');
            
            finishedProducts.forEach(product => {
                const option = document.createElement('option');
                option.value = product.id;
                option.textContent = product.description;
                productionProduct.appendChild(option);
            });
        }
        
        // Atualizar select de clientes para relatório de vendas por cliente
        function updateClientSalesClientSelect() {
            clientSalesClient.innerHTML = '<option value="all">Todos os Clientes</option>';
            
            clients.forEach(client => {
                const option = document.createElement('option');
                option.value = client.id;
                option.textContent = client.name;
                clientSalesClient.appendChild(option);
            });
        }
        
        // Salvar produtos no localStorage
        function saveProducts() {
            localStorage.setItem('products', JSON.stringify(products));
        }
        
        // Salvar produções no localStorage
        function saveProductions() {
            localStorage.setItem('productions', JSON.stringify(productions));
        }
        
        // Salvar movimentações de estoque no localStorage
        function saveStockMovements() {
            localStorage.setItem('stockMovements', JSON.stringify(stockMovementsList));
        }
        
        // Salvar clientes no localStorage
        function saveClients() {
            localStorage.setItem('clients', JSON.stringify(clients));
        }
        
        // Salvar vendas no localStorage
        function saveSales() {
            localStorage.setItem('sales', JSON.stringify(sales));
        }
        
        // Salvar usuários no localStorage
        function saveUsers() {
            localStorage.setItem('users', JSON.stringify(users));
        }
        
        // Adicionar ingrediente à receita
        addIngredientBtn.addEventListener('click', () => {
            addIngredientRow();
        });
        
        function addIngredientRow(ingredient = null) {
            const row = document.createElement('div');
            row.className = 'ingredient-row';
            
            // Filtrar apenas insumos e produtos intermediários para ingredientes
            const ingredientProducts = products.filter(p => p.type === 'supply' || p.type === 'intermediate');
            
            row.innerHTML = `
                <div class="form-group">
                    <label>Ingrediente</label>
                    <select class="ingredient-select" required>
                        <option value="">Selecione um ingrediente</option>
                        ${ingredientProducts.map(p => `<option value="${p.id}" ${ingredient && ingredient.id === p.id ? 'selected' : ''}>${p.description} (Estoque: ${p.stock} ${getUnitText(p.unit)})</option>`).join('')}
                    </select>
                </div>
                <div class="form-group">
                    <label>Quantidade</label>
                    <input type="number" class="ingredient-quantity" min="0" step="0.01" value="${ingredient ? ingredient.quantity : ''}" required>
                </div>
                <div class="form-group">
                    <label>Unidade</label>
                    <select class="ingredient-unit" required>
                        <!-- Opções serão preenchidas dinamicamente com base no produto selecionado -->
                    </select>
                </div>
                <button type="button" class="btn btn-danger remove-ingredient">Remover</button>
            `;
            
            ingredientsContainer.appendChild(row);
            
            // Adicionar evento para atualizar unidade quando ingrediente for selecionado
            const ingredientSelect = row.querySelector('.ingredient-select');
            const unitSelect = row.querySelector('.ingredient-unit');
            
            // Preencher unidade se já tiver um ingrediente selecionado
            if (ingredient && ingredient.id) {
                const product = products.find(p => p.id === ingredient.id);
                if (product) {
                    updateUnitOptions(unitSelect, product.unit);
                    unitSelect.value = ingredient.unit || product.unit;
                }
            }
            
            // Atualizar opções de unidade quando ingrediente for alterado
            ingredientSelect.addEventListener('change', function() {
                const productId = this.value;
                if (productId) {
                    const product = products.find(p => p.id === productId);
                    if (product) {
                        updateUnitOptions(unitSelect, product.unit);
                    }
                }
            });
            
            // Adicionar evento para remover ingrediente
            row.querySelector('.remove-ingredient').addEventListener('click', () => {
                row.remove();
            });
        }
        
        // Atualizar opções de unidade com base na embalagem do produto
        function updateUnitOptions(unitSelect, productUnit) {
            unitSelect.innerHTML = '';
            
            // Adicionar a unidade padrão do produto como primeira opção
            const defaultOption = document.createElement('option');
            defaultOption.value = productUnit;
            defaultOption.textContent = getUnitText(productUnit);
            unitSelect.appendChild(defaultOption);
            
            // Adicionar outras opções de conversão baseadas na unidade do produto
            if (productUnit === 'kg') {
                unitSelect.innerHTML += `
                    <option value="g">Gramas (g)</option>
                    <option value="kg">Quilogramas (kg)</option>
                `;
            } else if (productUnit === 'l') {
                unitSelect.innerHTML += `
                    <option value="ml">Mililitros (ml)</option>
                    <option value="l">Litros (l)</option>
                `;
            } else if (productUnit === 'un') {
                unitSelect.innerHTML += `
                    <option value="un">Unidades (un)</option>
                `;
            }
        }
        
        // Processar formulário de produção
        productionForm.addEventListener('submit', (e) => {
            e.preventDefault();
            
            const finishedProductId = finishedProductSelect.value;
            const batchSize = parseInt(document.getElementById('batch-size').value);
            
            if (!finishedProductId) {
                alert('Selecione um produto acabado!');
                return;
            }
            
            const finishedProduct = products.find(p => p.id === finishedProductId);
            if (!finishedProduct) {
                alert('Produto acabado não encontrado!');
                return;
            }
            
            // Coletar ingredientes
            const ingredientRows = ingredientsContainer.querySelectorAll('.ingredient-row');
            if (ingredientRows.length === 0) {
                alert('Adicione pelo menos um ingrediente!');
                return;
            }
            
            const ingredients = [];
            let totalCost = 0;
            let hasInsufficientStock = false;
            
            ingredientRows.forEach(row => {
                const select = row.querySelector('.ingredient-select');
                const quantityInput = row.querySelector('.ingredient-quantity');
                const unitSelect = row.querySelector('.ingredient-unit');
                
                const ingredientId = select.value;
                const quantity = parseFloat(quantityInput.value);
                const unit = unitSelect.value;
                
                if (!ingredientId || isNaN(quantity)) {
                    alert('Preencha todos os campos dos ingredientes!');
                    return;
                }
                
                const ingredientProduct = products.find(p => p.id === ingredientId);
                if (!ingredientProduct) {
                    alert('Ingrediente não encontrado!');
                    return;
                }
                
                // Verificar se há estoque suficiente
                if (ingredientProduct.stock < quantity) {
                    hasInsufficientStock = true;
                    row.style.border = '2px solid #e74c3c';
                } else {
                    row.style.border = '';
                }
                
                // Calcular custo do ingrediente (simplificado)
                let cost = 0;
                if (unit === 'g' || unit === 'ml') {
                    // Assumindo que o custo do produto é por kg ou litro
                    cost = (ingredientProduct.cost / 1000) * quantity;
                } else if (unit === 'kg' || unit === 'l') {
                    cost = ingredientProduct.cost * quantity;
                } else if (unit === 'un') {
                    cost = ingredientProduct.cost * quantity;
                }
                
                ingredients.push({
                    id: ingredientId,
                    product: ingredientProduct,
                    quantity,
                    unit,
                    cost
                });
                
                totalCost += cost;
            });
            
            if (hasInsufficientStock) {
                alert('Alguns ingredientes não possuem estoque suficiente! Verifique os itens destacados em vermelho.');
                saveProductionBtn.disabled = true;
                return;
            }
            
            // Calcular resultados
            const unitCost = totalCost / batchSize;
            const profitMargin = ((finishedProduct.price - unitCost) / finishedProduct.price) * 100;
            
            // Exibir resultados
            document.getElementById('total-cost').textContent = `R$ ${totalCost.toFixed(2)}`;
            document.getElementById('unit-cost').textContent = `R$ ${unitCost.toFixed(2)}`;
            document.getElementById('yield').textContent = `${batchSize} unidades`;
            document.getElementById('profit-margin').textContent = `${profitMargin.toFixed(2)}%`;
            
            // Atualizar produção atual
            currentProduction = {
                finishedProductId,
                finishedProduct,
                batchSize,
                ingredients,
                totalCost,
                unitCost,
                profitMargin,
                date: new Date().toISOString()
            };
            
            // Habilitar botão de salvar produção
            saveProductionBtn.disabled = false;
            
            productionResults.classList.remove('hidden');
        });
        
        // Salvar produção
        saveProductionBtn.addEventListener('click', () => {
            if (!currentProduction) return;
            
            // Atualizar estoque
            // Adicionar produto acabado ao estoque
            const finishedProduct = products.find(p => p.id === currentProduction.finishedProductId);
            if (finishedProduct) {
                finishedProduct.stock += currentProduction.batchSize;
                addStockMovement(finishedProduct.id, 'ENTRADA', currentProduction.batchSize, 'Produção');
            }
            
            // Remover ingredientes do estoque
            currentProduction.ingredients.forEach(ingredient => {
                const product = products.find(p => p.id === ingredient.id);
                if (product) {
                    product.stock -= ingredient.quantity;
                    addStockMovement(product.id, 'SAÍDA', ingredient.quantity, 'Produção');
                }
            });
            
            // Salvar produção no histórico
            productions.push({
                ...currentProduction,
                id: Date.now().toString()
            });
            
            // Salvar dados
            saveProducts();
            saveProductions();
            saveStockMovements();
            
            // Recarregar dados
            loadProducts();
            loadProductionHistory();
            loadStockMovements();
            
            // Limpar formulário
            productionForm.reset();
            ingredientsContainer.innerHTML = '';
            addIngredientRow();
            productionResults.classList.add('hidden');
            saveProductionBtn.disabled = true;
            currentProduction = null;
            
            alert('Produção salva com sucesso! Estoque atualizado.');
        });
        
        // Carregar histórico de produção
        function loadProductionHistory() {
            productionHistory.innerHTML = '';
            
            if (productions.length === 0) {
                productionHistory.innerHTML = '<p style="text-align: center; padding: 20px; color: #666;">Nenhuma produção registrada</p>';
                return;
            }
            
            // Ordenar produções por data (mais recente primeiro)
            const sortedProductions = [...productions].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            sortedProductions.forEach(production => {
                const item = document.createElement('div');
                item.className = 'history-item';
                
                const date = new Date(production.date).toLocaleDateString('pt-BR');
                const time = new Date(production.date).toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
                
                item.innerHTML = `
                    <div class="history-info">
                        <div class="history-date">${date} às ${time}</div>
                        <div class="history-product">${production.finishedProduct.description}</div>
                        <div class="history-details">Quantidade: ${production.batchSize} unidades | Custo total: R$ ${production.totalCost.toFixed(2)}</div>
                    </div>
                    <div class="history-quantity positive">+${production.batchSize}</div>
                `;
                
                productionHistory.appendChild(item);
            });
        }
        
        // Carregar tabela de estoque
        function loadStockTable() {
            stockTableBody.innerHTML = '';
            
            if (products.length === 0) {
                stockTableBody.innerHTML = '<tr><td colspan="8" style="text-align: center;">Nenhum produto cadastrado</td></tr>';
                return;
            }
            
            products.forEach(product => {
                const row = document.createElement('tr');
                const typeBadge = getTypeBadge(product.type);
                const stockClass = getStockClass(product.stock, product.minStock);
                const stockStatus = getStockStatus(product.stock, product.minStock);
                const unitText = getUnitText(product.unit);
                
                row.innerHTML = `
                    <td>${product.barcode}</td>
                    <td>${product.description}</td>
                    <td>${typeBadge}</td>
                    <td>${unitText}</td>
                    <td class="${stockClass}">${product.stock}</td>
                    <td>${product.minStock}</td>
                    <td>${stockStatus}</td>
                    <td>
                        <button class="btn btn-secondary" onclick="adjustStock('${product.id}')">Ajustar Estoque</button>
                    </td>
                `;
                stockTableBody.appendChild(row);
            });
        }
        
        // Obter status do estoque
        function getStockStatus(stock, minStock) {
            if (stock <= 0) return '<span class="stock-low">ESGOTADO</span>';
            if (stock <= minStock) return '<span class="stock-warning">BAIXO</span>';
            return '<span class="stock-ok">NORMAL</span>';
        }
        
        // Carregar movimentações de estoque
        function loadStockMovements() {
            stockMovements.innerHTML = '';
            
            if (stockMovementsList.length === 0) {
                stockMovements.innerHTML = '<p style="text-align: center; padding: 20px; color: #666;">Nenhuma movimentação registrada</p>';
                return;
            }
            
            // Ordenar movimentações por data (mais recente primeiro)
            const sortedMovements = [...stockMovementsList].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            sortedMovements.forEach(movement => {
                const product = products.find(p => p.id === movement.productId);
                if (!product) return;
                
                const item = document.createElement('div');
                item.className = 'history-item';
                
                const date = new Date(movement.date).toLocaleDateString('pt-BR');
                const time = new Date(movement.date).toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
                const quantityClass = movement.type === 'ENTRADA' ? 'positive' : 'negative';
                const quantitySymbol = movement.type === 'ENTRADA' ? '+' : '-';
                
                item.innerHTML = `
                    <div class="history-info">
                        <div class="history-date">${date} às ${time}</div>
                        <div class="history-product">${product.description}</div>
                        <div class="history-details">${movement.reason}</div>
                    </div>
                    <div class="history-quantity ${quantityClass}">${quantitySymbol}${movement.quantity}</div>
                `;
                
                stockMovements.appendChild(item);
            });
        }
        
        // Adicionar movimentação de estoque
        function addStockMovement(productId, type, quantity, reason) {
            const movement = {
                id: Date.now().toString(),
                productId,
                type,
                quantity,
                reason,
                date: new Date().toISOString()
            };
            
            stockMovementsList.push(movement);
            saveStockMovements();
        }
        
        // Cadastro de clientes - CORREÇÃO PRINCIPAL
        clientForm.addEventListener('submit', (e) => {
            e.preventDefault();
            
            const name = document.getElementById('client-name').value;
            const type = document.querySelector('input[name="client-type"]:checked').value;
            const cpf = document.getElementById('client-cpf').value;
            const cnpj = document.getElementById('client-cnpj').value;
            const companyName = document.getElementById('client-company-name').value;
            const email = document.getElementById('client-email').value;
            const phone = document.getElementById('client-phone').value;
            const whatsapp = document.getElementById('client-whatsapp').value;
            const address = document.getElementById('client-address').value;
            
            // Validar campos obrigatórios baseados no tipo
            if (type === 'physical' && !cpf) {
                alert('CPF é obrigatório para pessoa física!');
                return;
            }
            
            if (type === 'legal' && !cnpj) {
                alert('CNPJ é obrigatório para pessoa jurídica!');
                return;
            }
            
            // Validar se CPF/CNPJ já existe
            if (type === 'physical' && clients.find(c => c.cpf === cpf)) {
                alert('Já existe um cliente com este CPF!');
                return;
            }
            
            if (type === 'legal' && clients.find(c => c.cnpj === cnpj)) {
                alert('Já existe um cliente com este CNPJ!');
                return;
            }
            
            // Adicionar cliente
            const client = {
                id: Date.now().toString(),
                name,
                type,
                cpf: type === 'physical' ? cpf : '',
                cnpj: type === 'legal' ? cnpj : '',
                companyName: type === 'legal' ? companyName : '',
                email,
                phone,
                whatsapp,
                address,
                createdAt: new Date().toISOString()
            };
            
            clients.push(client);
            saveClients();
            loadClients(); // Atualizar a tabela após adicionar
            loadSaleClientSelect();
            updateClientSalesClientSelect();
            
            // Limpar formulário
            clientForm.reset();
            toggleClientFields(); // Reset para pessoa física
            
            alert('Cliente cadastrado com sucesso!');
        });
        
        // CORREÇÃO: Carregar clientes na tabela - FUNÇÃO PRINCIPAL CORRIGIDA
        function loadClients() {
            clientsTableBody.innerHTML = '';
            
            if (clients.length === 0) {
                clientsTableBody.innerHTML = '<tr><td colspan="7" style="text-align: center;">Nenhum cliente cadastrado</td></tr>';
                return;
            }
            
            clients.forEach(client => {
                const row = document.createElement('tr');
                const typeBadge = getClientTypeBadge(client.type);
                const documentNumber = client.type === 'physical' ? formatCPF(client.cpf) : formatCNPJ(client.cnpj);
                
                row.innerHTML = `
                    <td>${client.name}</td>
                    <td>${typeBadge}</td>
                    <td>${documentNumber}</td>
                    <td>${client.email}</td>
                    <td>${formatPhone(client.phone)}</td>
                    <td>${formatPhone(client.whatsapp)}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-secondary" onclick="editClient('${client.id}')">Editar</button>
                            <button class="btn btn-danger" onclick="deleteClient('${client.id}')">Excluir</button>
                        </div>
                    </td>
                `;
                clientsTableBody.appendChild(row);
            });
        }
        
        // Funções auxiliares para formatação
        function formatCPF(cpf) {
            if (!cpf) return '';
            return cpf.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/, '$1.$2.$3-$4');
        }
        
        function formatCNPJ(cnpj) {
            if (!cnpj) return '';
            return cnpj.replace(/(\d{2})(\d{3})(\d{3})(\d{4})(\d{2})/, '$1.$2.$3/$4-$5');
        }
        
        function formatPhone(phone) {
            if (!phone) return '';
            // Remove caracteres não numéricos
            const cleaned = phone.replace(/\D/g, '');
            
            if (cleaned.length === 11) {
                return cleaned.replace(/(\d{2})(\d{5})(\d{4})/, '($1) $2-$3');
            } else if (cleaned.length === 10) {
                return cleaned.replace(/(\d{2})(\d{4})(\d{4})/, '($1) $2-$3');
            }
            
            return phone;
        }
        
        // Obter badge para o tipo de cliente
        function getClientTypeBadge(type) {
            let badgeClass = '';
            let badgeText = '';
            
            switch(type) {
                case 'physical':
                    badgeClass = 'physical';
                    badgeText = 'Pessoa Física';
                    break;
                case 'legal':
                    badgeClass = 'legal';
                    badgeText = 'Pessoa Jurídica';
                    break;
            }
            
            return `<span class="customer-type-badge ${badgeClass}">${badgeText}</span>`;
        }
        
        // Alternar campos baseados no tipo de cliente
        function toggleClientFields() {
            const clientType = document.querySelector('input[name="client-type"]:checked').value;
            
            if (clientType === 'physical') {
                cpfField.classList.remove('conditional-field');
                cnpjField.classList.add('conditional-field');
                companyNameField.classList.add('conditional-field');
                
                document.getElementById('client-cpf').required = true;
                document.getElementById('client-cnpj').required = false;
                document.getElementById('client-company-name').required = false;
            } else {
                cpfField.classList.add('conditional-field');
                cnpjField.classList.remove('conditional-field');
                companyNameField.classList.remove('conditional-field');
                
                document.getElementById('client-cpf').required = false;
                document.getElementById('client-cnpj').required = true;
                document.getElementById('client-company-name').required = true;
            }
        }
        
        // Adicionar eventos para alternar campos de cliente
        clientTypeRadios.forEach(radio => {
            radio.addEventListener('change', toggleClientFields);
        });
        
        // Carregar select de clientes para venda
        function loadSaleClientSelect() {
            saleClient.innerHTML = '<option value="">Selecione um cliente</option>';
            
            clients.forEach(client => {
                const option = document.createElement('option');
                option.value = client.id;
                option.textContent = `${client.name} (${client.type === 'physical' ? formatCPF(client.cpf) : formatCNPJ(client.cnpj)})`;
                saleClient.appendChild(option);
            });
        }
        
        // PDV - Carregar produtos na grade
        function loadProductsGrid() {
            productsGrid.innerHTML = '';
            
            if (products.length === 0) {
                productsGrid.innerHTML = '<p style="text-align: center; padding: 20px; color: #666;">Nenhum produto cadastrado</p>';
                return;
            }
            
            // Filtrar produtos por tipo selecionado
            const selectedType = productTypeFilter.value;
            let filteredProducts = products;
            
            if (selectedType !== 'all') {
                filteredProducts = products.filter(product => product.type === selectedType && product.stock > 0);
            } else {
                filteredProducts = products.filter(product => product.stock > 0);
            }
            
            if (filteredProducts.length === 0) {
                productsGrid.innerHTML = '<p style="text-align: center; padding: 20px; color: #666;">Nenhum produto disponível para venda</p>';
                return;
            }
            
            filteredProducts.forEach(product => {
                const card = document.createElement('div');
                card.className = 'product-card';
                card.setAttribute('data-id', product.id);
                
                // Adicionar imagem do produto no PDV
                let imageHtml = '';
                if (product.image) {
                    imageHtml = `<img src="${product.image}" class="product-image-pdv" alt="${product.description}">`;
                } else {
                    imageHtml = `<div class="no-image">Sem imagem</div>`;
                }
                
                card.innerHTML = `
                    ${imageHtml}
                    <h4>${product.description}</h4>
                    <div class="price">R$ ${product.price.toFixed(2)}</div>
                    <div class="stock">Estoque: ${product.stock} ${getUnitText(product.unit)}</div>
                    <div>${getTypeBadge(product.type)}</div>
                `;
                
                card.addEventListener('click', () => {
                    addToCart(product);
                });
                
                productsGrid.appendChild(card);
            });
        }
        
        // PDV - Filtrar produtos por tipo
        productTypeFilter.addEventListener('change', loadProductsGrid);
        
        // PDV - Buscar produtos
        searchProductPdvBtn.addEventListener('click', () => {
            const searchTerm = productSearch.value.toLowerCase();
            
            if (!searchTerm) {
                loadProductsGrid();
                return;
            }
            
            const selectedType = productTypeFilter.value;
            let filteredProducts = products;
            
            if (selectedType !== 'all') {
                filteredProducts = products.filter(product => 
                    product.type === selectedType && 
                    product.stock > 0 && 
                    (product.description.toLowerCase().includes(searchTerm) || 
                     product.barcode.toLowerCase().includes(searchTerm))
                );
            } else {
                filteredProducts = products.filter(product => 
                    product.stock > 0 && 
                    (product.description.toLowerCase().includes(searchTerm) || 
                     product.barcode.toLowerCase().includes(searchTerm))
                );
            }
            
            productsGrid.innerHTML = '';
            
            if (filteredProducts.length === 0) {
                productsGrid.innerHTML = '<p style="text-align: center; padding: 20px; color: #666;">Nenhum produto encontrado</p>';
                return;
            }
            
            filteredProducts.forEach(product => {
                const card = document.createElement('div');
                card.className = 'product-card';
                card.setAttribute('data-id', product.id);
                
                // Adicionar imagem do produto no PDV
                let imageHtml = '';
                if (product.image) {
                    imageHtml = `<img src="${product.image}" class="product-image-pdv" alt="${product.description}">`;
                } else {
                    imageHtml = `<div class="no-image">Sem imagem</div>`;
                }
                
                card.innerHTML = `
                    ${imageHtml}
                    <h4>${product.description}</h4>
                    <div class="price">R$ ${product.price.toFixed(2)}</div>
                    <div class="stock">Estoque: ${product.stock} ${getUnitText(product.unit)}</div>
                    <div>${getTypeBadge(product.type)}</div>
                `;
                
                card.addEventListener('click', () => {
                    addToCart(product);
                });
                
                productsGrid.appendChild(card);
            });
        });
        
        // PDV - Adicionar produto ao carrinho
        function addToCart(product) {
            const existingItem = cart.find(item => item.id === product.id);
            
            if (existingItem) {
                if (existingItem.quantity < product.stock) {
                    existingItem.quantity += 1;
                } else {
                    alert(`Estoque insuficiente para ${product.description}. Disponível: ${product.stock}`);
                    return;
                }
            } else {
                if (product.stock > 0) {
                    cart.push({
                        id: product.id,
                        name: product.description,
                        price: product.price,
                        quantity: 1,
                        type: product.type,
                        unit: product.unit
                    });
                } else {
                    alert(`Estoque insuficiente para ${product.description}`);
                    return;
                }
            }
            
            updateCartDisplay();
        }
        
        // PDV - Atualizar exibição do carrinho
        function updateCartDisplay() {
            cartItems.innerHTML = '';
            
            if (cart.length === 0) {
                cartItems.innerHTML = '<p style="text-align: center; padding: 20px; color: #666;">Carrinho vazio</p>';
                cartSubtotal.textContent = 'R$ 0,00';
                cartDiscount.textContent = 'R$ 0,00';
                cartTotal.textContent = 'R$ 0,00';
                return;
            }
            
            let subtotal = 0;
            
            cart.forEach(item => {
                const itemTotal = item.price * item.quantity;
                subtotal += itemTotal;
                
                const cartItem = document.createElement('div');
                cartItem.className = 'cart-item';
                
                cartItem.innerHTML = `
                    <div class="cart-item-info">
                        <div class="cart-item-name">${item.name}</div>
                        <div class="cart-item-details">
                            <span>R$ ${item.price.toFixed(2)} x ${item.quantity} ${getUnitText(item.unit)}</span>
                            <span>R$ ${itemTotal.toFixed(2)}</span>
                        </div>
                        <div>${getTypeBadge(item.type)}</div>
                    </div>
                    <div class="cart-item-actions">
                        <input type="number" class="cart-item-quantity" value="${item.quantity}" min="1" max="${getProductStock(item.id)}" data-id="${item.id}">
                        <button class="remove-item" data-id="${item.id}">×</button>
                    </div>
                `;
                
                cartItems.appendChild(cartItem);
            });
            
            // Adicionar eventos aos inputs de quantidade e botões de remoção
            document.querySelectorAll('.cart-item-quantity').forEach(input => {
                input.addEventListener('change', (e) => {
                    const id = e.target.getAttribute('data-id');
                    const newQuantity = parseInt(e.target.value);
                    const maxStock = getProductStock(id);
                    
                    if (newQuantity > maxStock) {
                        alert(`Estoque insuficiente. Disponível: ${maxStock}`);
                        e.target.value = maxStock;
                        updateCartItemQuantity(id, maxStock);
                    } else if (newQuantity < 1) {
                        removeFromCart(id);
                    } else {
                        updateCartItemQuantity(id, newQuantity);
                    }
                    
                    updateCartDisplay();
                });
            });
            
            document.querySelectorAll('.remove-item').forEach(button => {
                button.addEventListener('click', (e) => {
                    const id = e.target.getAttribute('data-id');
                    removeFromCart(id);
                    updateCartDisplay();
                });
            });
            
            // Calcular desconto baseado no tipo selecionado
            const discountValue = parseFloat(discountInput.value) || 0;
            const discountType = document.querySelector('input[name="discount-type"]:checked').value;
            
            let discount = 0;
            if (discountType === 'percent') {
                discount = (subtotal * discountValue) / 100;
            } else {
                discount = discountValue;
            }
            
            const total = subtotal - discount;
            
            cartSubtotal.textContent = `R$ ${subtotal.toFixed(2)}`;
            cartDiscount.textContent = `R$ ${discount.toFixed(2)}`;
            cartTotal.textContent = `R$ ${total.toFixed(2)}`;
        }
        
        // PDV - Obter estoque do produto
        function getProductStock(productId) {
            const product = products.find(p => p.id === productId);
            return product ? product.stock : 0;
        }
        
        // PDV - Atualizar quantidade do item no carrinho
        function updateCartItemQuantity(productId, quantity) {
            const item = cart.find(item => item.id === productId);
            if (item) {
                item.quantity = quantity;
            }
        }
        
        // PDV - Remover item do carrinho
        function removeFromCart(productId) {
            cart = cart.filter(item => item.id !== productId);
        }
        
        // PDV - Atualizar desconto
        discountInput.addEventListener('input', () => {
            updateCartDisplay();
        });
        
        // Atualizar tipo de desconto
        discountTypeRadios.forEach(radio => {
            radio.addEventListener('change', () => {
                updateCartDisplay();
            });
        });
        
        // PDV - Limpar carrinho
        clearCartBtn.addEventListener('click', () => {
            cart = [];
            discountInput.value = '0';
            updateCartDisplay();
        });
        
        // PDV - Finalizar venda
        finalizeSaleBtn.addEventListener('click', () => {
            if (cart.length === 0) {
                alert('Adicione produtos ao carrinho antes de finalizar a venda.');
                return;
            }
            
            const discountValue = parseFloat(discountInput.value) || 0;
            const discountType = document.querySelector('input[name="discount-type"]:checked').value;
            const payment = paymentMethod.value;
            const clientId = saleClient.value;
            const client = clientId ? clients.find(c => c.id === clientId) : null;
            
            // Calcular total
            let subtotal = 0;
            cart.forEach(item => {
                subtotal += item.price * item.quantity;
            });
            
            // Calcular desconto baseado no tipo
            let discount = 0;
            if (discountType === 'percent') {
                discount = (subtotal * discountValue) / 100;
            } else {
                discount = discountValue;
            }
            
            const total = subtotal - discount;
            
            // Verificar estoque
            for (const item of cart) {
                const product = products.find(p => p.id === item.id);
                if (product.stock < item.quantity) {
                    alert(`Estoque insuficiente para ${item.name}. Disponível: ${product.stock}, Solicitado: ${item.quantity}`);
                    return;
                }
            }
            
            // Atualizar estoque
            cart.forEach(item => {
                const product = products.find(p => p.id === item.id);
                if (product) {
                    product.stock -= item.quantity;
                    addStockMovement(product.id, 'SAÍDA', item.quantity, 'Venda');
                }
            });
            
            // Salvar venda
            const sale = {
                id: Date.now().toString(),
                items: [...cart],
                subtotal,
                discount,
                discountType,
                total,
                payment,
                client: client ? {
                    id: client.id,
                    name: client.name,
                    document: client.type === 'physical' ? client.cpf : client.cnpj
                } : null,
                date: new Date().toISOString()
            };
            
            sales.push(sale);
            saveSales();
            saveProducts();
            saveStockMovements();
            
            // Exibir cupom
            showReceipt(sale);
            
            // Limpar carrinho
            cart = [];
            discountInput.value = '0';
            saleClient.value = '';
            updateCartDisplay();
        });
        
        // PDV - Exibir cupom
        function showReceipt(sale) {
            receiptDate.textContent = new Date().toLocaleString('pt-BR');
            receiptItems.innerHTML = '';
            
            sale.items.forEach(item => {
                const itemTotal = item.price * item.quantity;
                const receiptItem = document.createElement('div');
                receiptItem.className = 'receipt-item';
                
                receiptItem.innerHTML = `
                    <div>${item.name} (${item.quantity}x)</div>
                    <div>R$ ${itemTotal.toFixed(2)}</div>
                `;
                
                receiptItems.appendChild(receiptItem);
            });
            
            receiptTotal.textContent = `R$ ${sale.total.toFixed(2)}`;
            
            const paymentMethods = {
                cash: 'Dinheiro',
                pix: 'Pix',
                debit: 'Cartão de Débito',
                credit: 'Cartão de Crédito'
            };
            
            receiptPayment.textContent = paymentMethods[sale.payment];
            
            receipt.classList.remove('hidden');
        }
        
        // PDV - Imprimir cupom
        printReceiptBtn.addEventListener('click', () => {
            window.print();
        });
        
        // PDV - Enviar cupom por e-mail
        emailReceiptBtn.addEventListener('click', () => {
            const clientId = saleClient.value;
            const client = clientId ? clients.find(c => c.id === clientId) : null;
            
            if (client && client.email) {
                alert(`Cupom enviado para ${client.email}`);
            } else {
                alert('Nenhum cliente selecionado ou cliente não possui e-mail cadastrado.');
            }
        });
        
        // PDV - Nova venda
        newSaleBtn.addEventListener('click', () => {
            receipt.classList.add('hidden');
        });
        
        // RELATÓRIOS - Gerar relatório de vendas
        generateSalesReportBtn.addEventListener('click', () => {
            const startDate = salesStartDate.value;
            const endDate = salesEndDate.value;
            const paymentMethod = salesPaymentMethod.value;
            
            // Filtrar vendas
            let filteredSales = [...sales];
            
            if (startDate) {
                filteredSales = filteredSales.filter(sale => sale.date >= startDate);
            }
            
            if (endDate) {
                // Ajustar a data fim para incluir o dia inteiro
                const end = new Date(endDate);
                end.setHours(23, 59, 59, 999);
                filteredSales = filteredSales.filter(sale => sale.date <= end.toISOString());
            }
            
            if (paymentMethod !== 'all') {
                filteredSales = filteredSales.filter(sale => sale.payment === paymentMethod);
            }
            
            // Exibir resultados
            salesReportBody.innerHTML = '';
            
            if (filteredSales.length === 0) {
                salesReportBody.innerHTML = '<tr><td colspan="7" style="text-align: center;">Nenhuma venda encontrada no período</td></tr>';
                salesSummary.classList.add('hidden');
                return;
            }
            
            // Calcular totais
            let totalSales = 0;
            let totalDiscount = 0;
            let totalAmount = 0;
            
            filteredSales.forEach(sale => {
                totalSales += sale.subtotal;
                totalDiscount += sale.discount;
                totalAmount += sale.total;
                
                const row = document.createElement('tr');
                const date = new Date(sale.date).toLocaleDateString('pt-BR');
                const clientName = sale.client ? sale.client.name : 'Não informado';
                const itemsText = sale.items.map(item => `${item.quantity}x ${item.name}`).join(', ');
                
                row.innerHTML = `
                    <td>${date}</td>
                    <td>${clientName}</td>
                    <td>${getPaymentMethodText(sale.payment)}</td>
                    <td>${itemsText}</td>
                    <td>R$ ${sale.subtotal.toFixed(2)}</td>
                    <td>R$ ${sale.discount.toFixed(2)}</td>
                    <td>R$ ${sale.total.toFixed(2)}</td>
                `;
                
                salesReportBody.appendChild(row);
            });
            
            // Atualizar resumo
            totalSalesCount.textContent = filteredSales.length;
            totalSalesAmount.textContent = `R$ ${totalAmount.toFixed(2)}`;
            averageSale.textContent = `R$ ${(totalAmount / filteredSales.length).toFixed(2)}`;
            
            salesSummary.classList.remove('hidden');
        });
        
        // RELATÓRIOS - Gerar relatório de produção
        generateProductionReportBtn.addEventListener('click', () => {
            const startDate = productionStartDate.value;
            const endDate = productionEndDate.value;
            const productId = productionProduct.value;
            
            // Filtrar produções
            let filteredProductions = [...productions];
            
            if (startDate) {
                filteredProductions = filteredProductions.filter(production => production.date >= startDate);
            }
            
            if (endDate) {
                // Ajustar a data fim para incluir o dia inteiro
                const end = new Date(endDate);
                end.setHours(23, 59, 59, 999);
                filteredProductions = filteredProductions.filter(production => production.date <= end.toISOString());
            }
            
            if (productId !== 'all') {
                filteredProductions = filteredProductions.filter(production => production.finishedProductId === productId);
            }
            
            // Exibir resultados
            productionReportBody.innerHTML = '';
            
            if (filteredProductions.length === 0) {
                productionReportBody.innerHTML = '<tr><td colspan="6" style="text-align: center;">Nenhuma produção encontrada no período</td></tr>';
                productionSummary.classList.add('hidden');
                return;
            }
            
            // Calcular totais
            let totalCost = 0;
            let totalUnits = 0;
            
            filteredProductions.forEach(production => {
                totalCost += production.totalCost;
                totalUnits += production.batchSize;
                
                const row = document.createElement('tr');
                const date = new Date(production.date).toLocaleDateString('pt-BR');
                
                row.innerHTML = `
                    <td>${date}</td>
                    <td>${production.finishedProduct.description}</td>
                    <td>${production.batchSize}</td>
                    <td>R$ ${production.totalCost.toFixed(2)}</td>
                    <td>R$ ${production.unitCost.toFixed(2)}</td>
                    <td>${production.profitMargin.toFixed(2)}%</td>
                `;
                
                productionReportBody.appendChild(row);
            });
            
            // Atualizar resumo
            totalProductionsCount.textContent = filteredProductions.length;
            totalProductionCost.textContent = `R$ ${totalCost.toFixed(2)}`;
            totalUnitsProduced.textContent = totalUnits;
            
            productionSummary.classList.remove('hidden');
        });
        
        // RELATÓRIOS - Gerar relatório de vendas por cliente
        generateClientSalesReportBtn.addEventListener('click', () => {
            const startDate = clientSalesStartDate.value;
            const endDate = clientSalesEndDate.value;
            const clientId = clientSalesClient.value;
            
            // Filtrar vendas
            let filteredSales = [...sales];
            
            if (startDate) {
                filteredSales = filteredSales.filter(sale => sale.date >= startDate);
            }
            
            if (endDate) {
                // Ajustar a data fim para incluir o dia inteiro
                const end = new Date(endDate);
                end.setHours(23, 59, 59, 999);
                filteredSales = filteredSales.filter(sale => sale.date <= end.toISOString());
            }
            
            if (clientId !== 'all') {
                filteredSales = filteredSales.filter(sale => sale.client && sale.client.id === clientId);
            }
            
            // Exibir resultados
            clientSalesReportBody.innerHTML = '';
            
            if (filteredSales.length === 0) {
                clientSalesReportBody.innerHTML = '<tr><td colspan="7" style="text-align: center;">Nenhuma venda encontrada no período</td></tr>';
                clientSalesSummary.classList.add('hidden');
                return;
            }
            
            // Calcular totais
            let totalSales = 0;
            let totalDiscount = 0;
            let totalAmount = 0;
            
            filteredSales.forEach(sale => {
                totalSales += sale.subtotal;
                totalDiscount += sale.discount;
                totalAmount += sale.total;
                
                const row = document.createElement('tr');
                const date = new Date(sale.date).toLocaleDateString('pt-BR');
                const clientName = sale.client ? sale.client.name : 'Não informado';
                const itemsText = sale.items.map(item => `${item.quantity}x ${item.name}`).join(', ');
                
                row.innerHTML = `
                    <td>${date}</td>
                    <td>${clientName}</td>
                    <td>${getPaymentMethodText(sale.payment)}</td>
                    <td>${itemsText}</td>
                    <td>R$ ${sale.subtotal.toFixed(2)}</td>
                    <td>R$ ${sale.discount.toFixed(2)}</td>
                    <td>R$ ${sale.total.toFixed(2)}</td>
                `;
                
                clientSalesReportBody.appendChild(row);
            });
            
            // Atualizar resumo
            clientTotalSalesCount.textContent = filteredSales.length;
            clientTotalSalesAmount.textContent = `R$ ${totalAmount.toFixed(2)}`;
            clientAverageSale.textContent = `R$ ${(totalAmount / filteredSales.length).toFixed(2)}`;
            
            clientSalesSummary.classList.remove('hidden');
        });
        
        // RELATÓRIOS - Exportar PDF do relatório de vendas
        exportSalesPdfBtn.addEventListener('click', () => {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Título
            doc.setFontSize(16);
            doc.text('Relatório de Vendas', 105, 15, { align: 'center' });
            
            // Filtros aplicados
            doc.setFontSize(10);
            let filtersText = 'Filtros: ';
            if (salesStartDate.value) filtersText += `De ${salesStartDate.value} `;
            if (salesEndDate.value) filtersText += `Até ${salesEndDate.value} `;
            if (salesPaymentMethod.value !== 'all') filtersText += `| Pagamento: ${salesPaymentMethod.options[salesPaymentMethod.selectedIndex].text}`;
            
            doc.text(filtersText, 14, 25);
            
            // Dados das vendas
            const tableData = [];
            const headers = ['Data', 'Cliente', 'Pagamento', 'Subtotal', 'Desconto', 'Total'];
            
            let filteredSales = [...sales];
            
            if (salesStartDate.value) {
                filteredSales = filteredSales.filter(sale => sale.date >= salesStartDate.value);
            }
            
            if (salesEndDate.value) {
                const end = new Date(salesEndDate.value);
                end.setHours(23, 59, 59, 999);
                filteredSales = filteredSales.filter(sale => sale.date <= end.toISOString());
            }
            
            if (salesPaymentMethod.value !== 'all') {
                filteredSales = filteredSales.filter(sale => sale.payment === salesPaymentMethod.value);
            }
            
            filteredSales.forEach(sale => {
                const date = new Date(sale.date).toLocaleDateString('pt-BR');
                const clientName = sale.client ? sale.client.name : 'Não informado';
                
                tableData.push([
                    date,
                    clientName,
                    getPaymentMethodText(sale.payment),
                    `R$ ${sale.subtotal.toFixed(2)}`,
                    `R$ ${sale.discount.toFixed(2)}`,
                    `R$ ${sale.total.toFixed(2)}`
                ]);
            });
            
            // Adicionar tabela
            doc.autoTable({
                startY: 35,
                head: [headers],
                body: tableData,
                theme: 'grid',
                styles: { fontSize: 8 },
                headStyles: { fillColor: [106, 17, 203] }
            });
            
            // Resumo
            let totalAmount = 0;
            filteredSales.forEach(sale => {
                totalAmount += sale.total;
            });
            
            const finalY = doc.lastAutoTable.finalY + 10;
            doc.setFontSize(12);
            doc.text(`Total de Vendas: ${filteredSales.length}`, 14, finalY);
            doc.text(`Valor Total: R$ ${totalAmount.toFixed(2)}`, 14, finalY + 7);
            
            // Salvar PDF
            doc.save('relatorio_vendas.pdf');
        });
        
        // RELATÓRIOS - Exportar PDF do relatório de produção
        exportProductionPdfBtn.addEventListener('click', () => {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Título
            doc.setFontSize(16);
            doc.text('Relatório de Produção', 105, 15, { align: 'center' });
            
            // Filtros aplicados
            doc.setFontSize(10);
            let filtersText = 'Filtros: ';
            if (productionStartDate.value) filtersText += `De ${productionStartDate.value} `;
            if (productionEndDate.value) filtersText += `Até ${productionEndDate.value} `;
            if (productionProduct.value !== 'all') {
                const product = products.find(p => p.id === productionProduct.value);
                if (product) filtersText += `| Produto: ${product.description}`;
            }
            
            doc.text(filtersText, 14, 25);
            
            // Dados das produções
            const tableData = [];
            const headers = ['Data', 'Produto', 'Quantidade', 'Custo Total', 'Custo Unitário', 'Margem'];
            
            let filteredProductions = [...productions];
            
            if (productionStartDate.value) {
                filteredProductions = filteredProductions.filter(production => production.date >= productionStartDate.value);
            }
            
            if (productionEndDate.value) {
                const end = new Date(productionEndDate.value);
                end.setHours(23, 59, 59, 999);
                filteredProductions = filteredProductions.filter(production => production.date <= end.toISOString());
            }
            
            if (productionProduct.value !== 'all') {
                filteredProductions = filteredProductions.filter(production => production.finishedProductId === productionProduct.value);
            }
            
            filteredProductions.forEach(production => {
                const date = new Date(production.date).toLocaleDateString('pt-BR');
                
                tableData.push([
                    date,
                    production.finishedProduct.description,
                    production.batchSize,
                    `R$ ${production.totalCost.toFixed(2)}`,
                    `R$ ${production.unitCost.toFixed(2)}`,
                    `${production.profitMargin.toFixed(2)}%`
                ]);
            });
            
            // Adicionar tabela
            doc.autoTable({
                startY: 35,
                head: [headers],
                body: tableData,
                theme: 'grid',
                styles: { fontSize: 8 },
                headStyles: { fillColor: [106, 17, 203] }
            });
            
            // Resumo
            let totalCost = 0;
            let totalUnits = 0;
            filteredProductions.forEach(production => {
                totalCost += production.totalCost;
                totalUnits += production.batchSize;
            });
            
            const finalY = doc.lastAutoTable.finalY + 10;
            doc.setFontSize(12);
            doc.text(`Total de Produções: ${filteredProductions.length}`, 14, finalY);
            doc.text(`Unidades Produzidas: ${totalUnits}`, 14, finalY + 7);
            doc.text(`Custo Total: R$ ${totalCost.toFixed(2)}`, 14, finalY + 14);
            
            // Salvar PDF
            doc.save('relatorio_producao.pdf');
        });
        
        // RELATÓRIOS - Exportar PDF do relatório de vendas por cliente
        exportClientSalesPdfBtn.addEventListener('click', () => {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Título
            doc.setFontSize(16);
            doc.text('Relatório de Vendas por Cliente', 105, 15, { align: 'center' });
            
            // Filtros aplicados
            doc.setFontSize(10);
            let filtersText = 'Filtros: ';
            if (clientSalesStartDate.value) filtersText += `De ${clientSalesStartDate.value} `;
            if (clientSalesEndDate.value) filtersText += `Até ${clientSalesEndDate.value} `;
            if (clientSalesClient.value !== 'all') {
                const client = clients.find(c => c.id === clientSalesClient.value);
                if (client) filtersText += `| Cliente: ${client.name}`;
            }
            
            doc.text(filtersText, 14, 25);
            
            // Dados das vendas
            const tableData = [];
            const headers = ['Data', 'Cliente', 'Pagamento', 'Subtotal', 'Desconto', 'Total'];
            
            let filteredSales = [...sales];
            
            if (clientSalesStartDate.value) {
                filteredSales = filteredSales.filter(sale => sale.date >= clientSalesStartDate.value);
            }
            
            if (clientSalesEndDate.value) {
                const end = new Date(clientSalesEndDate.value);
                end.setHours(23, 59, 59, 999);
                filteredSales = filteredSales.filter(sale => sale.date <= end.toISOString());
            }
            
            if (clientSalesClient.value !== 'all') {
                filteredSales = filteredSales.filter(sale => sale.client && sale.client.id === clientSalesClient.value);
            }
            
            filteredSales.forEach(sale => {
                const date = new Date(sale.date).toLocaleDateString('pt-BR');
                const clientName = sale.client ? sale.client.name : 'Não informado';
                
                tableData.push([
                    date,
                    clientName,
                    getPaymentMethodText(sale.payment),
                    `R$ ${sale.subtotal.toFixed(2)}`,
                    `R$ ${sale.discount.toFixed(2)}`,
                    `R$ ${sale.total.toFixed(2)}`
                ]);
            });
            
            // Adicionar tabela
            doc.autoTable({
                startY: 35,
                head: [headers],
                body: tableData,
                theme: 'grid',
                styles: { fontSize: 8 },
                headStyles: { fillColor: [106, 17, 203] }
            });
            
            // Resumo
            let totalAmount = 0;
            filteredSales.forEach(sale => {
                totalAmount += sale.total;
            });
            
            const finalY = doc.lastAutoTable.finalY + 10;
            doc.setFontSize(12);
            doc.text(`Total de Vendas: ${filteredSales.length}`, 14, finalY);
            doc.text(`Valor Total: R$ ${totalAmount.toFixed(2)}`, 14, finalY + 7);
            
            // Salvar PDF
            doc.save('relatorio_vendas_cliente.pdf');
        });
        
        // Função auxiliar para obter o texto da forma de pagamento
        function getPaymentMethodText(payment) {
            const methods = {
                cash: 'Dinheiro',
                pix: 'Pix',
                debit: 'Cartão de Débito',
                credit: 'Cartão de Crédito'
            };
            
            return methods[payment] || payment;
        }
        
        // NOVAS FUNÇÕES: Consulta de produtos e clientes
        
        // Consulta de produtos
        searchProductConsultaBtn.addEventListener('click', searchProducts);
        
        function searchProducts() {
            const searchType = document.querySelector('input[name="product-search-type"]:checked').value;
            const searchTerm = productSearchInput.value.toLowerCase();
            
            productsTableBody.innerHTML = '';
            
            let filteredProducts = [];
            
            if (searchType === 'all') {
                filteredProducts = products;
            } else if (searchType === 'barcode') {
                filteredProducts = products.filter(product => 
                    product.barcode.toLowerCase().includes(searchTerm)
                );
            } else if (searchType === 'description') {
                filteredProducts = products.filter(product => 
                    product.description.toLowerCase().includes(searchTerm)
                );
            }
            
            if (filteredProducts.length === 0) {
                productsTableBody.innerHTML = '<tr><td colspan="8" style="text-align: center;">Nenhum produto encontrado</td></tr>';
                return;
            }
            
            filteredProducts.forEach(product => {
                const row = document.createElement('tr');
                const typeBadge = getTypeBadge(product.type);
                const stockClass = getStockClass(product.stock, product.minStock);
                const unitText = getUnitText(product.unit);
                
                row.innerHTML = `
                    <td>${product.barcode}</td>
                    <td>${product.description}</td>
                    <td>${typeBadge}</td>
                    <td>${unitText}</td>
                    <td>R$ ${product.cost.toFixed(2)}</td>
                    <td>R$ ${product.price.toFixed(2)}</td>
                    <td class="${stockClass}">${product.stock}</td>
                    <td>
                        <button class="btn btn-secondary" onclick="editProduct('${product.id}')">Editar</button>
                        <button class="btn btn-danger" onclick="deleteProduct('${product.id}')">Excluir</button>
                    </td>
                `;
                productsTableBody.appendChild(row);
            });
        }
        
        // Limpar busca de produtos
        clearProductSearch.addEventListener('click', () => {
            productSearchInput.value = '';
            loadProducts();
        });
        
        // Consulta de clientes
        searchClientBtn.addEventListener('click', searchClients);
        
        function searchClients() {
            const searchType = document.querySelector('input[name="client-search-type"]:checked').value;
            const searchTerm = clientSearchInput.value.toLowerCase();
            
            clientsTableBody.innerHTML = '';
            
            let filteredClients = [];
            
            if (searchType === 'all') {
                filteredClients = clients;
            } else if (searchType === 'name') {
                filteredClients = clients.filter(client => 
                    client.name.toLowerCase().includes(searchTerm)
                );
            } else if (searchType === 'cpf') {
                filteredClients = clients.filter(client => 
                    client.cpf && client.cpf.toLowerCase().includes(searchTerm)
                );
            } else if (searchType === 'cnpj') {
                filteredClients = clients.filter(client => 
                    client.cnpj && client.cnpj.toLowerCase().includes(searchTerm)
                );
            }
            
            if (filteredClients.length === 0) {
                clientsTableBody.innerHTML = '<tr><td colspan="7" style="text-align: center;">Nenhum cliente encontrado</td></tr>';
                return;
            }
            
            filteredClients.forEach(client => {
                const row = document.createElement('tr');
                const typeBadge = getClientTypeBadge(client.type);
                const document = client.type === 'physical' ? formatCPF(client.cpf) : formatCNPJ(client.cnpj);
                
                row.innerHTML = `
                    <td>${client.name}</td>
                    <td>${typeBadge}</td>
                    <td>${document}</td>
                    <td>${client.email}</td>
                    <td>${formatPhone(client.phone)}</td>
                    <td>${formatPhone(client.whatsapp)}</td>
                    <td>
                        <button class="btn btn-secondary" onclick="editClient('${client.id}')">Editar</button>
                        <button class="btn btn-danger" onclick="deleteClient('${client.id}')">Excluir</button>
                    </td>
                `;
                clientsTableBody.appendChild(row);
            });
        }
        
        // Limpar busca de clientes
        clearClientSearch.addEventListener('click', () => {
            clientSearchInput.value = '';
            loadClients();
        });
        
        // Funções globais para editar e excluir produtos
        window.editProduct = function(id) {
            const product = products.find(p => p.id === id);
            if (!product) return;
            
            document.getElementById('product-barcode').value = product.barcode;
            document.getElementById('product-description').value = product.description;
            document.getElementById('product-cost').value = product.cost;
            document.getElementById('product-price').value = product.price;
            document.getElementById('product-stock').value = product.stock;
            document.getElementById('product-min-stock').value = product.minStock;
            productUnitSelect.value = product.unit;
            
            // Carregar imagem se existir
            if (product.image) {
                productImagePreview.src = product.image;
                productImagePreview.style.display = 'block';
                removeImageBtn.style.display = 'inline-block';
            } else {
                productImagePreview.style.display = 'none';
                removeImageBtn.style.display = 'none';
            }
            
            // Selecionar o tipo de produto correto
            document.querySelector(`#product-type-${product.type}`).checked = true;
            
            // Remover produto da lista para evitar duplicação
            products = products.filter(p => p.id !== id);
            saveProducts();
            loadProducts();
        };
        
        window.deleteProduct = function(id) {
            if (confirm('Tem certeza que deseja excluir este produto?')) {
                products = products.filter(p => p.id !== id);
                saveProducts();
                loadProducts();
                updateFinishedProductSelect();
                updateProductionProductSelect();
            }
        };
        
        window.adjustStock = function(id) {
            const product = products.find(p => p.id === id);
            if (!product) return;
            
            const newStock = prompt(`Ajustar estoque de ${product.description} (Atual: ${product.stock}):`, product.stock);
            
            if (newStock !== null && !isNaN(parseFloat(newStock))) {
                const oldStock = product.stock;
                product.stock = parseFloat(newStock);
                
                // Registrar movimentação de ajuste
                const reason = 'Ajuste manual';
                if (product.stock > oldStock) {
                    addStockMovement(product.id, 'ENTRADA', product.stock - oldStock, reason);
                } else if (product.stock < oldStock) {
                    addStockMovement(product.id, 'SAÍDA', oldStock - product.stock, reason);
                }
                
                saveProducts();
                saveStockMovements();
                loadProducts();
                loadStockTable();
                loadStockMovements();
                
                alert('Estoque ajustado com sucesso!');
            }
        };
        
        // Funções globais para editar e excluir clientes
        window.editClient = function(id) {
            const client = clients.find(c => c.id === id);
            if (!client) return;
            
            document.getElementById('client-name').value = client.name;
            document.getElementById('client-email').value = client.email;
            document.getElementById('client-phone').value = client.phone;
            document.getElementById('client-whatsapp').value = client.whatsapp;
            document.getElementById('client-address').value = client.address;
            
            // Selecionar o tipo de cliente correto
            document.querySelector(`#client-type-${client.type}`).checked = true;
            toggleClientFields();
            
            // Preencher campos específicos do tipo
            if (client.type === 'physical') {
                document.getElementById('client-cpf').value = client.cpf;
            } else {
                document.getElementById('client-cnpj').value = client.cnpj;
                document.getElementById('client-company-name').value = client.companyName;
            }
            
            // Remover cliente da lista para evitar duplicação
            clients = clients.filter(c => c.id !== id);
            saveClients();
            loadClients();
        };
        
        window.deleteClient = function(id) {
            if (confirm('Tem certeza que deseja excluir este cliente?')) {
                clients = clients.filter(c => c.id !== id);
                saveClients();
                loadClients();
            }
        };
        
        // Verificar se há e-mail salvo
        window.addEventListener('DOMContentLoaded', () => {
            const savedEmail = localStorage.getItem('savedEmail');
            if (savedEmail) {
                document.getElementById('login-email').value = savedEmail;
                document.getElementById('remember-password').checked = true;
            }
            
            // Adicionar um ingrediente inicial
            addIngredientRow();
            
            // Inicializar campos de cliente
            toggleClientFields();
            
            // Configurar datas padrão para os relatórios (últimos 30 dias)
            const today = new Date();
            const lastMonth = new Date();
            lastMonth.setDate(today.getDate() - 30);
            
            salesStartDate.value = lastMonth.toISOString().split('T')[0];
            salesEndDate.value = today.toISOString().split('T')[0];
            
            productionStartDate.value = lastMonth.toISOString().split('T')[0];
            productionEndDate.value = today.toISOString().split('T')[0];
            
            clientSalesStartDate.value = lastMonth.toISOString().split('T')[0];
            clientSalesEndDate.value = today.toISOString().split('T')[0];
            
            // Adicionar alguns dados de exemplo se estiver vazio
            if (products.length === 0) {
                products = [
                    {
                        id: '1',
                        barcode: '7891234567890',
                        description: 'Pão Francês',
                        cost: 0.50,
                        price: 1.00,
                        stock: 100,
                        minStock: 20,
                        type: 'finished',
                        unit: 'un',
                        image: null
                    },
                    {
                        id: '2',
                        barcode: '7891234567891',
                        description: 'Farinha de Trigo',
                        cost: 2.50,
                        price: 5.00,
                        stock: 50,
                        minStock: 10,
                        type: 'supply',
                        unit: 'kg',
                        image: null
                    }
                ];
                saveProducts();
            }
            
            if (clients.length === 0) {
                clients = [
                    {
                        id: '1',
                        name: 'João Silva',
                        type: 'physical',
                        cpf: '12345678901',
                        cnpj: '',
                        companyName: '',
                        email: 'joao@email.com',
                        phone: '1133334444',
                        whatsapp: '1199998888',
                        address: 'Rua das Flores, 123 - São Paulo/SP',
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: '2',
                        name: 'Empresa XYZ Ltda',
                        type: 'legal',
                        cpf: '',
                        cnpj: '12345678000195',
                        companyName: 'Empresa XYZ Comércio',
                        email: 'contato@xyz.com',
                        phone: '1144445555',
                        whatsapp: '11988887777',
                        address: 'Av. Paulista, 1000 - São Paulo/SP',
                        createdAt: new Date().toISOString()
                    }
                ];
                saveClients();
            }
            
            // Carregar dados iniciais se estiver no dashboard
            if (dashboardContainer.classList.contains('hidden') === false) {
                loadProducts();
                updateFinishedProductSelect();
                loadProductionHistory();
                loadStockMovements();
                loadClients();
                loadSaleClientSelect();
                updateProductionProductSelect();
                updateClientSalesClientSelect();
            }
        });
    </script>
</body>
</html>